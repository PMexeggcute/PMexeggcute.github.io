<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="ğŸ˜˜ğŸ˜˜ğŸ˜˜">
<meta property="og:type" content="website">
<meta property="og:title" content="Sn0r1ax">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Sn0r1ax">
<meta property="og:description" content="ğŸ˜˜ğŸ˜˜ğŸ˜˜">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Sn0r1ax">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Sn0r1ax</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Sn0r1ax</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Sleep all day</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/12/27/I2C%E6%AD%BB%E9%94%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="Sn0r1ax">
      <meta itemprop="description" content="ğŸ˜˜ğŸ˜˜ğŸ˜˜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sn0r1ax">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/12/27/I2C%E6%AD%BB%E9%94%81/" class="post-title-link" itemprop="url">I2Cæ­»é”æˆå› åŠè§£å†³æ–¹æ³•</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-12-27 23:06:09" itemprop="dateCreated datePublished" datetime="2025-12-27T23:06:09+08:00">2025-12-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-12-28 16:10:18" itemprop="dateModified" datetime="2025-12-28T16:10:18+08:00">2025-12-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">åµŒå…¥å¼</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="ä»€ä¹ˆæ˜¯I2Cæ­»é”"><a href="#ä»€ä¹ˆæ˜¯I2Cæ­»é”" class="headerlink" title="ä»€ä¹ˆæ˜¯I2Cæ­»é”"></a>ä»€ä¹ˆæ˜¯I2Cæ­»é”</h2><p>ä¸€ç§I2Cé€šè®¯åœæ­¢å·¥ä½œçš„ç°è±¡</p>
<p>å…·ä½“è¡¨ç°ä¸ºSDAæ•°æ®çº¿ä¸€ç›´å¤„äºä½ç”µå¹³çŠ¶æ€</p>
<h2 id="ä»€ä¹ˆæ—¶å€™ä¼šå‘ç”ŸI2Cæ­»é”"><a href="#ä»€ä¹ˆæ—¶å€™ä¼šå‘ç”ŸI2Cæ­»é”" class="headerlink" title="ä»€ä¹ˆæ—¶å€™ä¼šå‘ç”ŸI2Cæ­»é”"></a>ä»€ä¹ˆæ—¶å€™ä¼šå‘ç”ŸI2Cæ­»é”</h2><h3 id="ä¸ä¼šå‘ç”ŸI2Cæ­»é”çš„æƒ…å†µ"><a href="#ä¸ä¼šå‘ç”ŸI2Cæ­»é”çš„æƒ…å†µ" class="headerlink" title="ä¸ä¼šå‘ç”ŸI2Cæ­»é”çš„æƒ…å†µ"></a>ä¸ä¼šå‘ç”ŸI2Cæ­»é”çš„æƒ…å†µ</h3><p>SCLæ—¶é’Ÿçº¿, SDAæ•°æ®çº¿å®Œå…¨äº¤ç”±ä¸»æœºæ§åˆ¶æ—¶, é€šå¸¸ä¸ä¼šå‘ç”ŸI2Cæ­»é”</p>
<h3 id="å¯èƒ½ä¼šå‘ç”ŸI2Cæ­»é”çš„æƒ…å†µ"><a href="#å¯èƒ½ä¼šå‘ç”ŸI2Cæ­»é”çš„æƒ…å†µ" class="headerlink" title="å¯èƒ½ä¼šå‘ç”ŸI2Cæ­»é”çš„æƒ…å†µ"></a>å¯èƒ½ä¼šå‘ç”ŸI2Cæ­»é”çš„æƒ…å†µ</h3><p>æ—¢ç„¶ä¸»æœºæ“æ§SDAæ—¶ä¸ä¼šå‘ç”Ÿæ­»é”(SCLç”±ä¸»æœºæ§åˆ¶), é‚£ä¹ˆå‘ç”Ÿæ­»é”çš„æƒ…å†µåªèƒ½æ˜¯ä»æœºå¯¼è‡´çš„</p>
<p>å¦‚æœä»æœºé”™è¯¯çš„æ“çºµSDAæ•°æ®çº¿åˆ™å¯èƒ½é€ æˆI2Cæ­»é”(SDAæ­»é”)</p>
<p>å¦‚æœä»æœº(ç‰¹å®šæƒ…å†µä¸‹ä»æœºä¹Ÿä¼šæ“çºµSCLæ—¶é’Ÿçº¿, è¯¦è§ä¸‹æ–‡)æˆ–ä¸»æœºé”™è¯¯çš„æ“çºµSCLæ—¶é’Ÿçº¿ä¹Ÿå¯èƒ½é€ æˆI2Cæ­»é”(SCLæ­»é”)</p>
<h2 id="ä¸ºä»€ä¹ˆä¼šå‘ç”ŸI2Cæ­»é”"><a href="#ä¸ºä»€ä¹ˆä¼šå‘ç”ŸI2Cæ­»é”" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šå‘ç”ŸI2Cæ­»é”"></a>ä¸ºä»€ä¹ˆä¼šå‘ç”ŸI2Cæ­»é”</h2><h3 id="SDAæ­»é”"><a href="#SDAæ­»é”" class="headerlink" title="SDAæ­»é”"></a>SDAæ­»é”</h3><p>ä»æœºæ‹‰ä½SDAæ•°æ®çº¿æœ‰ä»¥ä¸‹ä¸¤ç§æƒ…å†µ:</p>
<ul>
<li>å‘é€bit0</li>
<li>åº”ç­”ACK</li>
</ul>
<p>I2Cæœ‰è§„å®š: åœ¨SCLä½äºé«˜ç”µå¹³æœŸé—´, SDAæ˜¯ä¸èƒ½è¿›è¡Œæ›´æ”¹çš„</p>
<p><strong>å¦‚æœåœ¨SCLä½äºé«˜ç”µå¹³æœŸé—´, ä»æœºæ‹‰ä½SDAæ—¶, ä¸»æœºæ„å¤–å¤ä½æˆ–æ–­ç”µé‡å¯</strong></p>
<p><strong>æ­¤æ—¶ä»æœºè¯†åˆ«åˆ°SCLæ—¶é’Ÿçº¿ä¸€ç›´ä¸ºé«˜ç”µå¹³, å°±ä¼šä¸€ç›´æ‹‰ä½SDAæ•°æ®çº¿</strong></p>
<p><strong>è€Œä¸»æœºI2Cç¡¬ä»¶è¯†åˆ«åˆ°SDAæ•°æ®çº¿ä¸€ç›´å¤„äºä½ç”µå¹³çŠ¶æ€, ä¼šè®¤ä¸ºI2Cæ€»çº¿ä¸€ç›´å¤„äºbusyçŠ¶æ€, å°±ä¼šä¸€ç›´ä¸æ‹‰ä½SCLæ—¶é’Ÿçº¿(æ­»ç­‰)</strong></p>
<p>å› æ­¤é€ æˆSDAæ­»é”</p>
<p><em>è€Œå¦‚æœæ˜¯SDAä½äºé«˜ç”µå¹³æ—¶ä¸»æœºæ„å¤–å¤ä½æˆ–æ–­ç”µé‡å¯åˆ™ä¸ä¼šè¿›å…¥æ­»é”, åªæ˜¯è¿™ä¸€å¸§çš„æ•°æ®ä¼šå‡ºé”™(ä¸»æœºéƒ½å¤ä½æˆ–é‡å¯äº† ä½ ä¸å‡ºé”™è°å‡ºé”™â€¦)</em></p>
<h3 id="SCLæ­»é”"><a href="#SCLæ­»é”" class="headerlink" title="SCLæ­»é”"></a>SCLæ­»é”</h3><p>é€šå¸¸ä¸»æœºå’Œä»æœºé€šä¿¡è¿‡ç¨‹ä¸­, ä¼šé€šè¿‡<strong>æ¥æ”¶æ•°æ®FIFO</strong>æ¥æ¥æ”¶æ•°æ®, å¦‚æœè¯¥FIFOæ»¡æ—¶, åˆ™ä¼šä¸»åŠ¨æ‹‰ä½SCLæ€»çº¿(ä»æœºä¹Ÿä¼šæ‹‰ä½SCL, å³ä½¿è¯¥SClæ˜¯ç”±ä¸»æœºæ“æ§)æ¥é€šçŸ¥å¦ä¸€æ–¹åœæ­¢å‘é€æ•°æ®, ç­‰æ¥æ”¶å®Œæ•°æ®åå†é‡æ–°é‡Šæ”¾SCL, ä¸€éå¦ä¸€æ–¹ç»§ç»­å‘é€æ•°æ® è¿™ç§æ–¹å¼ç§°ä¸º<strong>I2Cæ—¶é’Ÿå»¶å±•</strong></p>
<p>ä½†å¦‚æœé€šä¿¡åŒæ–¹æœ‰å…¶ä¸­ä¸€æ–¹æ²¡æœ‰å¤„ç†è¿™ç§æƒ…å†µåˆ™å¯èƒ½ä¼šå¯¼è‡´SCLæ­»é”</p>
<p><img src="/../images/I2C%E6%AD%BB%E9%94%81/0.png" alt="0"></p>
<p>[^STM32F403RCT6ä¸MLX90640è¿›è¡ŒI2Cé€šä¿¡]: D0ä¸ºSCLæ—¶é’Ÿçº¿, D1ä¸ºSDAæ•°æ®çº¿</p>
<p>å¯åˆ†ä¸ºå››æ®µæ¥çœ‹, å‰ä¸‰æ®µæ¨æµ‹æ˜¯ä¸€æ¬¡æ€§é€šä¿¡æ•°æ®è¿‡å¤§é€ æˆçš„æ­»é”æƒ…å†µ, ç¬¬å››æ®µåˆ™æ˜¯æ­£å¸¸åˆ†ä¸¤æ®µæ•°æ®å‘é€çš„æƒ…å†µ(å…¶å®æ˜¯ä¸¤ä¸ªä¸¤æ®µæ•°æ®, å…±å››ç»„æ•°æ®):</p>
<ul>
<li>è¿™é‡ŒSDAæ­»é”æ—¶ä½äºé«˜ç”µå¹³è¿˜æ˜¯ä½ç”µå¹³å½±å“å› ç´ è¿‡å¤š, è¿™é‡Œå…ˆç†è§£ä¸ºéšæœº</li>
<li>æ¥æ”¶æ•°æ®FIFOæ»¡æ—¶ ä¸»åŠ¨æ‹‰ä½SCL, ç„¶åSDAç­‰å¾…ä¸‹ä¸€ä¸ªSCLé«˜ç”µå¹³(ä¸‹ä¸€ä¸ªæ—¶é’Ÿ)</li>
</ul>
<p>è¿™é‡Œå®æµ‹å°±ç®—æ¨¡æ‹ŸI2Cçš„SCLä¿¡å·ä¹Ÿä¸èƒ½ä½¿ä»æœºç»§ç»­å‘é€æ•°æ®, ä½†æ˜¯èƒ½ä½¿SDAæ•°æ®çº¿é‡æ–°å›åˆ°é«˜ç”µå¹³</p>
<p>å¯ä»¥é€šè¿‡ä¸»æœºæ‹‰é«˜SCLæ‰€ä»¥ç»“è®ºæ˜¯ä¸»æœºçš„é—®é¢˜, è¿›ä¸€æ­¥æ¨æµ‹æ˜¯ä¸»æœºFIFOæ»¡å¯¼è‡´</p>
<p>æ­»é”æ—¶SDAä½äºé«˜ç”µå¹³æ—¶æŸ¥çœ‹ä¸»æœºçš„<code>I2C_SR1</code>å¯„å­˜å™¨, å€¼ä¸º0x40(å‘é€å¯„å­˜å™¨ç©º), <code>I2C_SR2</code>å¯„å­˜å™¨å€¼ä¸º0x3(æ€»çº¿busy, ä¸»æœºä½äºå‘é€æ¨¡å¼)</p>
<p>æ­»é”æ—¶SDAä½äºä½ç”µå¹³æ—¶ä¸¤ä¸ªå¯„å­˜å™¨å€¼ä¸º0x0, 0x2(æ€»çº¿busy)</p>
<p><strong>å…·ä½“é—®é¢˜è§¦å‘åŸå› ä¸æ˜, æ¬¢è¿äº¤æµ</strong></p>
<h2 id="å¦‚ä½•é¿å…-è§£å†³I2Cæ­»é”"><a href="#å¦‚ä½•é¿å…-è§£å†³I2Cæ­»é”" class="headerlink" title="å¦‚ä½•é¿å…&#x2F;è§£å†³I2Cæ­»é”"></a>å¦‚ä½•é¿å…&#x2F;è§£å†³I2Cæ­»é”</h2><h3 id="SDAæ­»é”-1"><a href="#SDAæ­»é”-1" class="headerlink" title="SDAæ­»é”"></a>SDAæ­»é”</h3><ul>
<li>å½“ä¸»æœºè¯†åˆ«åˆ°I2Cæ­»é”æ—¶, ç›´æ¥å¤ä½ä»æœº</li>
<li>é€‰æ‹©å¸¦æœ‰çœ‹é—¨ç‹—å¤ä½çš„I2Cå™¨ä»¶, è‡ªåŠ¨å¤ä½</li>
<li>ä¸»æœºè¯†åˆ«åˆ°I2Cæ­»é”å, å°†SCL&#x2F;SDAå¼•è„šé…ç½®ä¸ºGPIOæ¨¡å¼, SCLè¾“å‡ºä¿¡å·æ¨¡æ‹ŸI2Cæ—¶é’Ÿ, ä¸€è¾¹SDAè¯»å–ç”µå¹³, ä¸€æ—¦SDAè¯»å–åˆ°é«˜ç”µå¹³å°±æ§åˆ¶SCLæ¨¡æ‹Ÿç»“æŸä¿¡å·, è¯¥æ–¹å¼ç§°ä¸º**â€æœ€å¤šå‘é€9clockæ¢å¤I2Cæ€»çº¿â€, å¸¸ç”¨**(ä¸ºä»€ä¹ˆæ˜¯9clock, å› ä¸º8ä¸ªæ•°æ®ä½+ä¸€ä¸ªackä½åˆšå¥½9ä½)</li>
</ul>
<h3 id="SCLæ­»é”-1"><a href="#SCLæ­»é”-1" class="headerlink" title="SCLæ­»é”"></a>SCLæ­»é”</h3><ul>
<li><strong>å”¯ä¸€ä¸”æœ‰æ•ˆçš„æ–¹æ³•å°±æ˜¯å¤ä½ä»æœº</strong></li>
</ul>
<h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®:"></a>å‚è€ƒæ–‡çŒ®:</h2><p>â€‹		<a target="_blank" rel="noopener" href="https://www.eet-china.com/mp/a344299.html">IICæ­»é”åˆ†æä¸è§£é”æ–¹æ¡ˆ</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/12/17/FreeRTOS(%E4%BA%94)-%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="Sn0r1ax">
      <meta itemprop="description" content="ğŸ˜˜ğŸ˜˜ğŸ˜˜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sn0r1ax">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/12/17/FreeRTOS(%E4%BA%94)-%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">FreeRTOSå­¦ä¹ ç¬”è®°(äº”) èµ„æºç®¡ç†</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-12-17 19:05:44" itemprop="dateCreated datePublished" datetime="2025-12-17T19:05:44+08:00">2025-12-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-12-18 13:57:01" itemprop="dateModified" datetime="2025-12-18T13:57:01+08:00">2025-12-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">åµŒå…¥å¼</span></a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/FreeRTOS/" itemprop="url" rel="index"><span itemprop="name">FreeRTOS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="ä¸ºä»€ä¹ˆè¦è¿›è¡Œèµ„æºç®¡ç†"><a href="#ä¸ºä»€ä¹ˆè¦è¿›è¡Œèµ„æºç®¡ç†" class="headerlink" title="ä¸ºä»€ä¹ˆè¦è¿›è¡Œèµ„æºç®¡ç†"></a>ä¸ºä»€ä¹ˆè¦è¿›è¡Œèµ„æºç®¡ç†</h2><p>åœ¨freertosä¸­, é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ä¼šæŠ¢å ä½ä¼˜å…ˆçº§çš„ä»»åŠ¡, ä¸­æ–­åˆä¼šæŠ¢å é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡</p>
<p>è¯•æƒ³ä»¥ä¸‹è¿™ä¸ªæƒ…æ™¯:</p>
<p>ä»»åŠ¡Aæ­£åœ¨è®¿é—®å˜é‡X</p>
<p>è¿™æ—¶ä»»åŠ¡Bç”±äºæ›´é«˜çš„ä¼˜å…ˆçº§, æŠ¢å äº†ä»»åŠ¡A, åŒæ—¶ä¹Ÿè®¿é—®å˜é‡X(ä¾‹å¦‚åšäº†ä¸€ä¸ª++æ“ä½œ)</p>
<p>ä»»åŠ¡Bç»“æŸ, ä»»åŠ¡Aå¯¹å˜é‡Xåšä¸€ä¸ª*10æ“ä½œ</p>
<p>è¿™æ—¶é—®é¢˜å°±å‡ºç°äº†, å¾€å¾€æˆ‘ä»¬ä½¿ä»»åŠ¡Aè¿›å…¥å°±ç»ªæ€ç›®æ ‡æ˜¯ä¸ºäº†ä½¿ç°åœ¨çš„Xå˜ä¸ºåŸæ¥çš„10å€, å¯ç°åœ¨Xå˜ä¸ºäº†åŸæ¥çš„10å€è¿˜è¦å¤š10</p>
<p>è¿™æ˜æ˜¾å’Œæˆ‘ä»¬çš„é¢„æœŸä¸ç¬¦</p>
<p>é‚£ä¹ˆæœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥é¿å…è¿™ç§æƒ…å†µå‘¢?</p>
<p>ç¬¬ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨<strong>ä¸´ç•ŒåŒº</strong></p>
<p>é€šè¿‡<code>taskENTER_CRITICAL()</code>å’Œ<code>taskEXIT_CRITICAL()</code>åˆ’å®šä¸´ç•ŒåŒº</p>
<p>æ‰§è¡Œé‡Œé¢çš„ä»£ç ä½¿ä»»ä½•å…¶ä»–ä»»åŠ¡å’Œä¼˜å…ˆçº§ç›¸åŒæˆ–æ›´ä½çš„ä¸­æ–­éƒ½ä¼šå¤±æ•ˆ</p>
<p>ä¸´ç•ŒåŒºæ‰€å±è”½çš„ä¼˜å…ˆçº§åœ¨<code>FreeRTOSConfig.h</code>ä¸­<code>configMAX_SYSCALL_INTERRUPT_PRIORITY</code>è®¾ç½®</p>
<p>è¯¥æ“ä½œæ˜¯å¯ä»¥åµŒå¥—çš„, ç”±å†…æ ¸è®°å½•åµŒå¥—çš„æ·±åº¦, æ·±åº¦å½’0æ—¶é€€å‡ºä¸´ç•ŒåŒº</p>
<p>ç”¨ä¾‹:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">vPrintString</span><span class="params">( <span class="type">const</span> <span class="type">char</span> *pcString )</span></span><br><span class="line">&#123;</span><br><span class="line">     <span class="comment">/* Write the string to stdout, using a critical section as a crude method of</span></span><br><span class="line"><span class="comment">     mutual exclusion. */</span></span><br><span class="line">     taskENTER_CRITICAL();</span><br><span class="line">     &#123;</span><br><span class="line">         <span class="built_in">printf</span>( <span class="string">&quot;%s&quot;</span>, pcString );</span><br><span class="line">         fflush( <span class="built_in">stdout</span> );</span><br><span class="line">     &#125;</span><br><span class="line">     taskEXIT_CRITICAL();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">vAnInterruptServiceRoutine</span><span class="params">( <span class="type">void</span> )</span>	<span class="comment">//ä¸­æ–­å®‰å…¨ç‰ˆæœ¬</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* Declare a variable in which the return value from</span></span><br><span class="line"><span class="comment">    taskENTER_CRITICAL_FROM_ISR() will be saved. */</span></span><br><span class="line">    UBaseType_t uxSavedInterruptStatus;</span><br><span class="line">    <span class="comment">/* This part of the ISR can be interrupted by any higher priority</span></span><br><span class="line"><span class="comment">    interrupt. */</span></span><br><span class="line">    <span class="comment">/* Use taskENTER_CRITICAL_FROM_ISR() to protect a region of this ISR.</span></span><br><span class="line"><span class="comment">    Save the value returned from taskENTER_CRITICAL_FROM_ISR() so it can</span></span><br><span class="line"><span class="comment">    be passed into the matching call to taskEXIT_CRITICAL_FROM_ISR(). */</span></span><br><span class="line">    uxSavedInterruptStatus = taskENTER_CRITICAL_FROM_ISR();</span><br><span class="line">    <span class="comment">/* This part of the ISR is between the call to</span></span><br><span class="line"><span class="comment">    taskENTER_CRITICAL_FROM_ISR() and taskEXIT_CRITICAL_FROM_ISR(), so can</span></span><br><span class="line"><span class="comment">    only be interrupted by interrupts that have a priority above that set</span></span><br><span class="line"><span class="comment">    by the configMAX_SYSCALL_INTERRUPT_PRIORITY constant. */</span></span><br><span class="line">    <span class="comment">/* Exit the critical section again by calling taskEXIT_CRITICAL_FROM_ISR(),</span></span><br><span class="line"><span class="comment">    passing in the value returned by the matching call to</span></span><br><span class="line"><span class="comment">    taskENTER_CRITICAL_FROM_ISR(). */</span></span><br><span class="line">    taskEXIT_CRITICAL_FROM_ISR( uxSavedInterruptStatus );</span><br><span class="line">    <span class="comment">/* This part of the ISR can be interrupted by any higher priority</span></span><br><span class="line"><span class="comment">    interrupt. */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾, ä¸´ç•ŒåŒºé‡Œçš„ä»£ç å±è”½äº†æ‰€æœ‰ä¼˜å…ˆçº§ç›¸åŒæˆ–æ›´ä½çš„ä¸­æ–­</p>
<p>å¯èƒ½å¯¼è‡´å¿…è¦çš„ä¸­æ–­æ— æ³•æ‰§è¡Œ</p>
<p>æ‰€ä»¥è¦æ±‚ä¸´ç•ŒåŒºè¦å°½é‡çš„çŸ­, ä¸Šé¢è¿™ä¸ªä¾‹å­æ˜æ˜¾ä¸ç¬¦åˆè¿™ä¸ªè¦æ±‚</p>
<p>ç¬¬äºŒç§æ–¹æ³•æ˜¯é€šè¿‡<strong>æš‚åœè°ƒåº¦å™¨</strong></p>
<p>é€šè¿‡<code> vTaskSuspendAll()</code>å’Œ<code>xTaskResumeAll() </code></p>
<p>æ‰§è¡Œå®Œ<code>vTaskSuspendAll()</code>ä¼šæš‚åœè°ƒåº¦å™¨çš„æ‰§è¡Œ, ä½†æ˜¯ä¸­æ–­ä¸å—å½±å“</p>
<p>è°ƒåº¦å™¨æš‚åœäº†å°±ä¸ä¼šæœ‰æ›´é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡æ¥æŠ¢å äº†</p>
<p>è¿™ä¸ªæ“ä½œæ˜¯å¯ä»¥åµŒå¥—çš„</p>
<p>å†…æ ¸ä¼šè®°å½•åµŒå¥—æ·±åº¦, åªæœ‰åµŒå¥—æ·±åº¦å½’0æ—¶, æ‰ä¼šæ¢å¤è°ƒåº¦å™¨</p>
<p>ç¼ºç‚¹å°±æ˜¯ç»ˆç«¯ä»æœ‰å¯èƒ½å¸¦æ¥å¹²æ‰°, åŒæ—¶æ¢å¤è°ƒåº¦å™¨é€šå¸¸æ˜¯ä¸€ä¸ªè¾ƒä¸ºè€—è´¹æ—¶é—´çš„è¿‡ç¨‹</p>
<p>ç¤ºä¾‹:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">vPrintString</span><span class="params">( <span class="type">const</span> <span class="type">char</span> *pcString )</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/* Write the string to stdout, suspending the scheduler as a method of</span></span><br><span class="line"><span class="comment">mutual exclusion. */</span></span><br><span class="line">    vTaskSuspendScheduler();</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>( <span class="string">&quot;%s&quot;</span>, pcString );</span><br><span class="line">        fflush( <span class="built_in">stdout</span> );</span><br><span class="line">    &#125;</span><br><span class="line">        xTaskResumeScheduler();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>ç¬¬ä¸‰ç§æ–¹æ³•åˆ™æ˜¯ä½¿ç”¨äº’æ–¥é‡</p>
<p>é€šè¿‡å°†<code>FreeRTOSConfig.h</code>ä¸­<code>configUSE_MUTEXES</code>è®¾ç½®ä¸º1ä»¥å¯ç”¨äº’æ–¥é”</p>
<p>äº’æ–¥é‡å¯ä»¥çœ‹ä½œæ˜¯ä¸€ç§ç‰¹æ®Šçš„ä¿¡å·é‡</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">prvNewPrintString</span><span class="params">( <span class="type">const</span> <span class="type">char</span> *pcString )</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* The mutex is created before the scheduler is started, so already exists</span></span><br><span class="line"><span class="comment">    by the time this task executes.</span></span><br><span class="line"><span class="comment">    Attempt to take the mutex, blocking indefinitely to wait for the mutex</span></span><br><span class="line"><span class="comment">    if it is not available straight away. The call to xSemaphoreTake() will</span></span><br><span class="line"><span class="comment">    only return when the mutex has been successfully obtained, so there is</span></span><br><span class="line"><span class="comment">    no need to check the function return value. If any other delay period</span></span><br><span class="line"><span class="comment">    was used then the code must check that xSemaphoreTake() returns pdTRUE</span></span><br><span class="line"><span class="comment">    before accessing the shared resource (which in this case is standard</span></span><br><span class="line"><span class="comment">    out). As noted earlier in this book, indefinite time outs are not</span></span><br><span class="line"><span class="comment">    recommended for production code. */</span></span><br><span class="line">    xSemaphoreTake( xMutex, portMAX_DELAY );</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/* The following line will only execute once the mutex has been</span></span><br><span class="line"><span class="comment">        successfully obtained. Standard out can be accessed freely now as</span></span><br><span class="line"><span class="comment">        only one task can have the mutex at any one time. */</span></span><br><span class="line">        <span class="built_in">printf</span>( <span class="string">&quot;%s&quot;</span>, pcString );</span><br><span class="line">        fflush( <span class="built_in">stdout</span> );</span><br><span class="line">        <span class="comment">/* The mutex MUST be given back! */</span></span><br><span class="line">    &#125;</span><br><span class="line">    xSemaphoreGive( xMutex );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>ä¸åŒçš„ç‚¹åœ¨äºå…¶å…·æœ‰æ‰€æœ‰æƒå’Œä¼˜å…ˆçº§ç»§æ‰¿æœºåˆ¶</p>
<p>ä¼˜å…ˆçº§ç»§æ‰¿æœºåˆ¶å¯ä»¥ç”¨äºè§£å†³ä¼˜å…ˆçº§åè½¬é—®é¢˜</p>
<p>é‚£ä¹ˆä»€ä¹ˆæ˜¯ä¼˜å…ˆçº§åè½¬å‘¢?</p>
<p>å…ˆä»äº’æ–¥é‡æœºåˆ¶è¯´èµ·, ä¸¤ä¸ªä»»åŠ¡åœ¨è®¿é—®åŒä¸€èµ„æºæ—¶, éœ€è¦å…ˆtakeäº’æ–¥é‡</p>
<p>æ­¤æ—¶å¦ä¸€ä¸ªä»»åŠ¡å†takeè¯¥ä¿¡å·é‡æ—¶å°±ä¼šå› ä¸ºæ— æ³•å¾—åˆ°äº’æ–¥é‡é™·å…¥é˜»å¡çŠ¶æ€</p>
<p>å¾…äº’æ–¥é‡è¢«giveåå¦ä¸€ä¸ªä»»åŠ¡åˆé‡æ–°è¿›å…¥å°±ç»ªæ€</p>
<p><img src="/../images/FreeRTOS/13.png" alt="13"></p>
<p>è¯•æƒ³ä»¥ä¸‹æƒ…æ™¯, ç°åœ¨æœ‰ä¸‰ä¸ªä»»åŠ¡, LPæœ€ä½ä¼˜å…ˆçº§ä»»åŠ¡ MPä¸­ç­‰ä¼˜å…ˆçº§ä»»åŠ¡ HPæœ€é«˜ä¼˜å…ˆçº§ä»»åŠ¡</p>
<p>ä»»åŠ¡LPå’ŒHPä½¿ç”¨äº’æ–¥é‡æ¥æ§åˆ¶å¯¹åŒä¸€èµ„æºçš„ä½¿ç”¨</p>
<p>ç°åœ¨LPå…ˆè¿›å…¥è¿è¡Œæ€, takeäº’æ–¥é‡</p>
<p>ç´§è·Ÿç€HPè¢«è§¦å‘è¿›å…¥å°±ç»ªæ€, å› ä¸ºé«˜ä¼˜å…ˆçº§åŸå› æŠ¢å LP</p>
<p>HPåœ¨å°è¯•takeäº’æ–¥é‡çš„æ—¶å€™, å› ä¸ºæ­¤æ—¶äº’æ–¥é‡åœ¨LPä»»åŠ¡æ‰‹é‡Œ, äºæ˜¯è¿›å…¥é˜»å¡æ€</p>
<p>å›åˆ°LPä»»åŠ¡, æ­¤æ—¶MPä»»åŠ¡è¿›å…¥å°±ç»ªæ€, æŠ¢å LPä»»åŠ¡</p>
<p>çŸ¥é“MPä»»åŠ¡è¿è¡Œå®Œæ¯•å›åˆ°LPä»»åŠ¡, LPä»»åŠ¡è¿è¡Œå®Œæ¯•æ‰è½®åˆ°HPä»»åŠ¡</p>
<p>é—®é¢˜å°±å‡ºç°åœ¨è¿™é‡Œ: HPä»»åŠ¡æ˜æ˜æ˜¯æœ€é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡, å´åˆ°äº†æœ€åæ‰æ‰§è¡Œ</p>
<p><img src="/../images/FreeRTOS/15.png" alt="15"></p>
<p>ä¸ºäº†ç¼“è§£è¿™ç§é—®é¢˜(æ— æ³•è¢«æ ¹é™¤), äº’æ–¥é‡å¼•å…¥äº†ä¼˜å…ˆçº§ç»§æ‰¿æœºåˆ¶</p>
<p><strong>ä¼˜å…ˆçº§ç»§æ‰¿çš„å·¥ä½œåŸç†æ˜¯: æš‚æ—¶å°†äº’æ–¥é”çš„æŒæœ‰è€…çš„ä¼˜å…ˆçº§æå‡è‡³å°è¯•è·å–åŒä¸€äº’æ–¥é”çš„æœ€é«˜ä¼˜å…ˆçº§ä»»åŠ¡çš„ä¼˜å…ˆçº§</strong></p>
<p>æŒæœ‰äº’æ–¥é”çš„ä½ä¼˜å…ˆçº§ä»»åŠ¡<strong>ç»§æ‰¿</strong>äº†è¯¥ä¼˜å…ˆçº§</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ä¸Šè¿°æƒ…æ™¯å°†ä¼šå˜ä¸º:</p>
<p>LPä»»åŠ¡å…ˆè¿›å…¥è¿è¡Œæ€</p>
<p>HPä»»åŠ¡è¿›å…¥å°±ç»ªæ€, æŠ¢å LP</p>
<p>HPä»»åŠ¡è·å–äº’æ–¥é”å¤±è´¥, LPä»»åŠ¡çš„ä¼˜å…ˆçº§æå‡è‡³HPä¼˜å…ˆçº§åŒä¸€æ°´å¹³</p>
<p>MPä»»åŠ¡è¿›å…¥å°±ç»ªæ€, ä¼˜å…ˆçº§ä½äºLP æ•…æ— æ³•è¿›è¡ŒæŠ¢å </p>
<p>LPä»»åŠ¡æ‰§è¡Œå®Œæ¯•, HPä»»åŠ¡è¿›å…¥è¿è¡Œæ€</p>
<p>HPä»»åŠ¡æ‰§è¡Œå®Œæ¯•, MPä»»åŠ¡è¿›å…¥è¿è¡Œæ€</p>
<p><img src="/../images/FreeRTOS/16.png" alt="16"></p>
<p>å½“æœ‰å¤šä¸ªä»»åŠ¡ä½¿ç”¨åŒä¸€äº’æ–¥é‡çš„æ—¶å€™, ç»§æ‰¿ä¼˜å…ˆçº§çš„è§„åˆ™æ˜¯å¦‚ä½•å‘¢?</p>
<ul>
<li>å¦‚æœä»»åŠ¡åœ¨æœªé‡Šæ”¾å…¶å·²æŒæœ‰çš„äº’æ–¥é”çš„æƒ…å†µä¸‹è·å–äº†æ–°çš„äº’æ–¥é”, åˆ™è¯¥ä»»åŠ¡çš„ç»§æ‰¿ä¼˜å…ˆçº§å¯èƒ½è¿›ä¸€æ­¥æå‡</li>
<li>ä»»åŠ¡ä¼šä¿æŒå…¶ç»§æ‰¿çš„æœ€é«˜ä¼˜å…ˆçº§, ç›´åˆ°å…¶é‡Šæ”¾æ‰€æœ‰çš„äº’æ–¥é”, ä¸”ä¸äº’æ–¥é”é‡Šæ”¾çš„é¡ºåºæ— å…³</li>
<li>å½“ä¸€ä¸ªä»»åŠ¡åŒæ—¶æŒæœ‰å¤šä¸ªäº’æ–¥é‡æ—¶ï¼Œåªè¦å…¶ä¸­ä»»æ„ä¸€ä¸ªäº’æ–¥é‡æ›¾å¯¼è‡´å®ƒç»§æ‰¿è¿‡æ›´é«˜çš„ä¼˜å…ˆçº§ï¼Œé‚£ä¹ˆè¯¥ä»»åŠ¡ä¼šä¸€ç›´ä¿æŒâ€œæœ€é«˜çš„ç»§æ‰¿ä¼˜å…ˆçº§â€ï¼Œå³ä½¿ç­‰å¾…è¿™äº›äº’æ–¥é‡çš„å…¶ä»–ä»»åŠ¡åæ¥è¶…æ—¶æ”¾å¼ƒç­‰å¾…ï¼Œä¹Ÿä¸ä¼šç«‹å³æ¢å¤åŸä¼˜å…ˆçº§ã€‚</li>
</ul>
<p>è¿™æ„å‘³ç€, ç»§æ‰¿çš„ä»»åŠ¡æ€»æ˜¯ä¿æŒåœ¨ä¸€ä¸ªè¾ƒé«˜çš„ä¼˜å…ˆçº§, å¾ˆå¥½çš„ç¼“è§£äº†ä¼˜å…ˆçº§åè½¬çš„é—®é¢˜</p>
<p>äº’æ–¥é”çš„å¦ä¸€ä¸ªç¼ºé™·æ˜¯æ­»é”(Deadlock, Deadly Embarce)</p>
<p>å½¢æˆåŸå› æ˜¯ç”±äºä¸¤ä¸ªä»»åŠ¡éƒ½åœ¨ç­‰å¾…å¯¹æ–¹å½’è¿˜äº’æ–¥é‡, å¯¼è‡´ä¸¤ä¸ªä»»åŠ¡éƒ½è¿›å…¥é˜»å¡æ€</p>
<p>è¯•æƒ³ä»¥ä¸‹åœºæ™¯: </p>
<p>æœ‰ä»»åŠ¡A, ä»»åŠ¡B, ä»»åŠ¡Aå…ˆtakeäº’æ–¥é‡X, å†takeäº’æ–¥é‡Y ä»»åŠ¡Bå…ˆtakeäº’æ–¥é‡Yå†takeäº’æ–¥é‡X</p>
<p>ä»»åŠ¡Aå…ˆè¿›å…¥è¿è¡Œæ€, takeäº’æ–¥é‡X</p>
<p>ä¸€ä¸ªæ—¶é—´ç‰‡è¿‡å», ä»»åŠ¡Bè¿›å…¥è¿è¡Œæ€, takeäº’æ–¥é‡Y</p>
<p>åˆä¸€ä¸ªæ—¶é—´ç‰‡è¿‡å», ä»»åŠ¡A take äº’æ–¥é‡Yå¤±è´¥, è¿›å…¥é˜»å¡æ€</p>
<p>ä»»åŠ¡B è¿›å…¥è¿è¡Œæ€, takeäº’æ–¥é‡X, è¿›å…¥é˜»å¡æ€</p>
<p>è¿™æ—¶ä¸¤ä¸ªä»»åŠ¡å‡åœ¨ç­‰å¾…å¯¹æ–¹å½’è¿˜äº’æ–¥é‡</p>
<p>ä½†æˆ‘ä»¬çŸ¥é“, å¦‚æœtakeå‡½æ•°çš„ç­‰å¾…æ—¶é—´å‡ä¸ºæ— é™ç­‰å¾…çš„è¯, è¿™ä¸¤ä¸ªä»»åŠ¡å°†æ°¸è¿œæ— æ³•æ‰§è¡Œ</p>
<p>åŒæ ·, æ­»é”ä¹Ÿæ˜¯æ— æ³•å®Œå…¨æ¶ˆé™¤çš„, åªèƒ½åœ¨è®¾è®¡æ—¶å°½é‡é¿å…</p>
<p>æœ€ç®€å•çš„é¿å…æ–¹æ³•å°±æ˜¯ç»™takeå‡½æ•°è®¾ç½®ä¸€ä¸ªæ¯”é¢„æœŸç­‰å¾…æ—¶é—´ç¨é•¿çš„è¶…æ—¶æ—¶é—´, è®©å…¶takeå¤±è´¥ç»§ç»­æ‰§è¡Œå‰©ä¸‹çš„éƒ¨åˆ†</p>
<p>å¯¹äºå•ä¸ªä»»åŠ¡ä¹Ÿæœ‰å¯èƒ½å‘ç”Ÿæ­»é”</p>
<p>æƒ…æ™¯å¦‚ä¸‹:</p>
<p>ä»»åŠ¡Aè·å–äº’æ–¥é”X</p>
<p>ä¹‹åä»»åŠ¡Aå†è·å–äº’æ–¥é”X, æ­¤æ—¶Xå·²ç»è¢«å ç”¨äº†, æ— æ³•è·å–, ä»»åŠ¡Aè¿›å…¥é˜»å¡æ€</p>
<p>å½¢æˆæ­»é”</p>
<p>è§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨é€’å½’äº’æ–¥é”(Recursive Mutexes)</p>
<p>ä½¿ç”¨æ–¹æ³•ä¸æ ‡å‡†äº’æ–¥é”ç±»ä¼¼, ä¸è¿‡é€’å½’äº’æ–¥é”å’Œå®ƒåç§°ä¸€æ ·æ”¯æŒé€’å½’è°ƒç”¨</p>
<p>takeå¤šå°‘æ¬¡å°±éœ€è¦giveå¤šå°‘æ¬¡æ‰èƒ½è§£é™¤äº’æ–¥é”</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Recursive mutexes are variables of type SemaphoreHandle_t. */</span></span><br><span class="line">SemaphoreHandle_t xRecursiveMutex;</span><br><span class="line"><span class="comment">/* The implementation of a task that creates and uses a recursive mutex. */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">vTaskFunction</span><span class="params">( <span class="type">void</span> *pvParameters )</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">const</span> TickType_t xMaxBlock20ms = pdMS_TO_TICKS( <span class="number">20</span> );</span><br><span class="line">    <span class="comment">/* Before a recursive mutex is used it must be explicitly created. */</span></span><br><span class="line">    xRecursiveMutex = xSemaphoreCreateRecursiveMutex();</span><br><span class="line">    <span class="comment">/* Check the semaphore was created successfully. configASSERT() is</span></span><br><span class="line"><span class="comment">    described in section 11.2. */</span></span><br><span class="line">    configASSERT( xRecursiveMutex );</span><br><span class="line">    <span class="comment">/* As per most tasks, this task is implemented as an infinite loop. */</span></span><br><span class="line">    <span class="keyword">for</span>( ;; )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/* ... */</span></span><br><span class="line">        <span class="comment">/* Take the recursive mutex. */</span></span><br><span class="line">        <span class="keyword">if</span>( xSemaphoreTakeRecursive( xRecursiveMutex, xMaxBlock20ms ) == pdPASS )</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">/* The recursive mutex was successfully obtained. The task can now</span></span><br><span class="line"><span class="comment">            access the resource the mutex is protecting. At this point the</span></span><br><span class="line"><span class="comment">            recursive call count (which is the number of nested calls to</span></span><br><span class="line"><span class="comment">            xSemaphoreTakeRecursive()) is 1, as the recursive mutex has</span></span><br><span class="line"><span class="comment">            only been taken once. */</span></span><br><span class="line">            <span class="comment">/* While it already holds the recursive mutex, the task takes the</span></span><br><span class="line"><span class="comment">            mutex again. In a real application, this is only likely to occur</span></span><br><span class="line"><span class="comment">            inside a sub-function called by this task, as there is no</span></span><br><span class="line"><span class="comment">            practical reason to knowingly take the same mutex more than</span></span><br><span class="line"><span class="comment">            once. The calling task is already the mutex holder, so the</span></span><br><span class="line"><span class="comment">            second call to xSemaphoreTakeRecursive() does nothing more than</span></span><br><span class="line"><span class="comment">            increment the recursive call count to 2. */</span></span><br><span class="line">            xSemaphoreTakeRecursive( xRecursiveMutex, xMaxBlock20ms );</span><br><span class="line">            <span class="comment">/* ... */</span></span><br><span class="line">            <span class="comment">/* The task returns the mutex after it has finished accessing the</span></span><br><span class="line"><span class="comment">            resource the mutex is protecting. At this point the recursive</span></span><br><span class="line"><span class="comment">            call count is 2, so the first call to xSemaphoreGiveRecursive()</span></span><br><span class="line"><span class="comment">            does not return the mutex. Instead, it simply decrements the</span></span><br><span class="line"><span class="comment">            recursive call count back to 1. */</span></span><br><span class="line">            xSemaphoreGiveRecursive( xRecursiveMutex );</span><br><span class="line">            <span class="comment">/* The next call to xSemaphoreGiveRecursive() decrements the</span></span><br><span class="line"><span class="comment">            recursive call count to 0, so this time the recursive mutex is</span></span><br><span class="line"><span class="comment">            returned. */</span></span><br><span class="line">            xSemaphoreGiveRecursive( xRecursiveMutex );</span><br><span class="line">            <span class="comment">/* Now one call to xSemaphoreGiveRecursive() has been executed for </span></span><br><span class="line"><span class="comment">            every proceeding call to xSemaphoreTakeRecursive(), so the task</span></span><br><span class="line"><span class="comment">            is no longer the mutex holder. */</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p>ç›¸åŒä¼˜å…ˆçº§ä»»åŠ¡ä½¿ç”¨äº’æ–¥é” å¤„ç†æ—¶é—´ä¸å‡é—®é¢˜</p>
<p>æƒ…æ™¯:</p>
<p>ä»»åŠ¡A,Bä¸¤ä¸ªç›¸åŒä¼˜å…ˆçº§ä»»åŠ¡, ä¸¤ä¸ªä»»åŠ¡éƒ½æ¥è‡ªåŒä¸€ä¸ªæ¨¡æ¿, è¯¥æ¨¡æ¿å¦‚ä¸‹:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* The implementation of a task that uses a mutex in a tight loop. The task</span></span><br><span class="line"><span class="comment">creates a text string in a local buffer, then writes the string to a display.</span></span><br><span class="line"><span class="comment">Access to the display is protected by a mutex. */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">vATask</span><span class="params">( <span class="type">void</span> *pvParameter )</span></span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">extern</span> SemaphoreHandle_t xMutex;</span><br><span class="line">    <span class="type">char</span> cTextBuffer[ <span class="number">128</span> ];</span><br><span class="line">    <span class="keyword">for</span>( ;; )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/* Generate the text string â€“ this is a fast operation. */</span></span><br><span class="line">        vGenerateTextInALocalBuffer( cTextBuffer );				<span class="comment">//å¿«æ“ä½œ</span></span><br><span class="line">        <span class="comment">/* Obtain the mutex that is protecting access to the display. */</span></span><br><span class="line">        xSemaphoreTake( xMutex, portMAX_DELAY );</span><br><span class="line">        <span class="comment">/* Write the generated text to the displayâ€“this is a slow operation. */</span></span><br><span class="line">        vCopyTextToFrameBuffer( cTextBuffer );					<span class="comment">//æ…¢æ“ä½œ</span></span><br><span class="line">        <span class="comment">/* The text has been written to the display, so return the mutex. */</span></span><br><span class="line">        xSemaphoreGive( xMutex );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä½¿ç”¨å¿«æ“ä½œå’Œæ…¢æ“ä½œåŒºåˆ†è¯¥æ¨¡æ¿ä¸­çš„ä¸¤ä¸ªæƒ­æ€</p>
<p>ä»»åŠ¡Aå…ˆæ‰§è¡Œå¿«æ“ä½œ, ä¹‹åtakeäº’æ–¥é‡</p>
<p>ä¸€ä¸ªæ—¶é—´ç‰‡è¿‡å», åˆ‡æ¢åˆ°ä»»åŠ¡B</p>
<p>ä»»åŠ¡Bæ‰§è¡Œå®Œå¿«æ“ä½œ, takeäº’æ–¥é‡å¤±è´¥, è¿›å…¥é˜»å¡æ€, åœ¨æ—¶é—´ç‰‡ç»“æŸä¹‹å‰åˆ‡æ¢åˆ°ä»»åŠ¡A</p>
<p>ä»»åŠ¡Aæ‰§è¡Œå®Œæ…¢æ“ä½œä¸”giveäº’æ–¥é‡, ä»»åŠ¡Bå›åˆ°å°±ç»ªæ€</p>
<p>ç”±äºä¼˜å…ˆçº§ç›¸åŒ, ä»»åŠ¡Bæ— æ³•æŠ¢å ä»»åŠ¡A</p>
<p>ä»»åŠ¡Aç»§ç»­æ‰§è¡Œå®Œå¿«æ“ä½œç„¶åtakeäº’æ–¥é‡, æ—¶é—´ç‰‡ç»“æŸåˆ‡æ¢åˆ°ä»»åŠ¡B</p>
<p>ä»»åŠ¡B takeäº’æ–¥é‡å¤±è´¥, åˆå›åˆ°é˜»å¡æ€</p>
<p><img src="/../images/FreeRTOS/14.png" alt="14"></p>
<p>ä»»åŠ¡Açš„å ç”¨æ—¶é—´è¿œå¤§äºä»»åŠ¡B, è¿™æ˜¯ä¸åˆç†çš„</p>
<p>è§£å†³æ–¹æ³•æ˜¯åœ¨åˆé€‚çš„æ—¶æœºä½¿ç”¨<code>taskYIELD()</code>ä¸»åŠ¨åˆ‡æ¢ä¸Šä¸‹æ–‡</p>
<p>æ‰‹å†Œç»™å‡ºçš„ç¤ºä¾‹</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">vFunction</span><span class="params">( <span class="type">void</span> *pvParameter )</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">extern</span> SemaphoreHandle_t xMutex;</span><br><span class="line">    <span class="type">char</span> cTextBuffer[ <span class="number">128</span> ];</span><br><span class="line">    TickType_t xTimeAtWhichMutexWasTaken;</span><br><span class="line">    <span class="keyword">for</span>( ;; )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/* Generate the text string â€“ this is a fast operation. */</span></span><br><span class="line">        vGenerateTextInALocalBuffer( cTextBuffer );</span><br><span class="line">        <span class="comment">/* Obtain the mutex that is protecting access to the display. */</span></span><br><span class="line">        xSemaphoreTake( xMutex, portMAX_DELAY );</span><br><span class="line">        <span class="comment">/* Record the time at which the mutex was taken. */</span></span><br><span class="line">        xTimeAtWhichMutexWasTaken = xTaskGetTickCount();</span><br><span class="line">        <span class="comment">/* Write the generated text to the displayâ€“this is a slow operation. */</span></span><br><span class="line">        vCopyTextToFrameBuffer( cTextBuffer );</span><br><span class="line">        <span class="comment">/* The text has been written to the display, so return the mutex. */</span></span><br><span class="line">        xSemaphoreGive( xMutex );</span><br><span class="line">        <span class="comment">/* If taskYIELD() was called on each iteration then this task would</span></span><br><span class="line"><span class="comment">        only ever remain in the Running state for a short period of time,</span></span><br><span class="line"><span class="comment">        and processing time would be wasted by rapidly switching between</span></span><br><span class="line"><span class="comment">        tasks. Therefore, only call taskYIELD() if the tick count changed</span></span><br><span class="line"><span class="comment">        while the mutex was held. */</span></span><br><span class="line">        <span class="keyword">if</span>( xTaskGetTickCount() != xTimeAtWhichMutexWasTaken )		<span class="comment">//å¦‚æœç»“æŸæ—¶å’Œè·å–äº’æ–¥é‡æ—¶ä¸ä½äºåŒä¸€æ—¶é—´ç‰‡</span></span><br><span class="line">        &#123;</span><br><span class="line">            taskYIELD();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“ç„¶è¿™ä¸ªç¤ºä¾‹å¹¶ä¸èƒ½å®Œå…¨è§£å†³è¿™ä¸ªé—®é¢˜, é€šè¿‡æ—¶é—´ç‰‡æ¥è¿›è¡Œåˆ¤æ–­å¾€å¾€ä¸å¤Ÿç²¾ç¡®</p>
<p>ä½†ç¡®å®èƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šç¼“è§£è¯¥é—®é¢˜</p>
<p>ç¬¬å››ç§æ–¹å¼åˆ™æ˜¯ä½¿ç”¨gatekeeperä»»åŠ¡</p>
<p>æ ¸å¿ƒæ˜¯é€šè¿‡å”¯ä¸€çš„ä¸€ä¸ªä»»åŠ¡æ¥ä½¿ç”¨è¿™ä¸ªå…±äº«çš„èµ„æº, ä»»åŠ¡é—´é€šè¿‡é˜Ÿåˆ—å‘GateKeeperä»»åŠ¡ä¼ é€æ•°æ®</p>
<p>ç”±GateKeeperä»»åŠ¡æ¥å¯¹å…±äº«çš„èµ„æºè¿›è¡Œæ“ä½œ</p>
<p>æœ‰æ—¶ä¸ºäº†æ›´å¿«çš„å¯¹æ•°æ®è¿›è¡Œå¤„ç†é€šå¸¸ä¼šç»™GateKeeperä»»åŠ¡ä¸€ä¸ªè¾ƒé«˜çš„ä¼˜å…ˆçº§, è¿™ä¼šå¯¼è‡´GateKeeperä»»åŠ¡å»¶è¿Ÿå¤„ç†ä¼˜å…ˆçº§è¾ƒä½çš„ä»»åŠ¡</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/12/10/FreeRTOS(%E5%9B%9B)-%E4%B8%AD%E6%96%AD%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="Sn0r1ax">
      <meta itemprop="description" content="ğŸ˜˜ğŸ˜˜ğŸ˜˜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sn0r1ax">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/12/10/FreeRTOS(%E5%9B%9B)-%E4%B8%AD%E6%96%AD%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">FreeRTOSå­¦ä¹ ç¬”è®°(å››) ä¸­æ–­ç®¡ç†</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-12-10 22:57:22" itemprop="dateCreated datePublished" datetime="2025-12-10T22:57:22+08:00">2025-12-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-12-16 22:44:25" itemprop="dateModified" datetime="2025-12-16T22:44:25+08:00">2025-12-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">åµŒå…¥å¼</span></a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/FreeRTOS/" itemprop="url" rel="index"><span itemprop="name">FreeRTOS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>å¤§éƒ¨åˆ†freertos apiå‡½æ•°éƒ½æœ‰ä¸¤ä¸ªç‰ˆæœ¬, åŒºåˆ«åœ¨äºåç§°åé¢çš„FromISR</p>
<p>å¸¦æœ‰æ”¹åç¼€çš„, ç§°ä¸ºä¸­æ–­å®‰å…¨å‡½æ•°</p>
<p>ä¸ºä»€ä¹ˆæ‰§è¡ŒåŒä¸€åŠŸèƒ½çš„å‡½æ•°å¿…é¡»è®¾è®¡ä¸ºä¸¤ä¸ªç‰ˆæœ¬å‘¢</p>
<p>å…¶æ ¹æœ¬åŸå› æ˜¯å› ä¸º åœ¨å‡½æ•°è°ƒç”¨ä¹‹ä¸­ å¦‚æœä½¿æ›´é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡è¿›å…¥åˆ°å°±ç»ªæ€, è¯¥ä»»åŠ¡åˆ™ä¼šæŠ¢å å½“å‰ä»»åŠ¡</p>
<p>è€Œåœ¨ä¸­æ–­ä¸­ä¸èƒ½è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢</p>
<p>é‚£ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜, freertosçš„è®¾è®¡é‡‡ç”¨äº†å°†å…¶åˆ†ä¸ºä¸¤ä¸ªå‡½æ•°çš„åšæ³•</p>
<p>è¿™æ ·çš„ä¼˜åŠ¿æ˜¯:</p>
<p>ä»£ç ä¸ç”¨å†å»å®ç° è¾¨åˆ«å‡½æ•°æ¥æºçš„é€»è¾‘ å³ä¸ç”¨å»åˆ¤å®šå…¶æ˜¯ä»ä¸­æ–­ä¸­è°ƒç”¨çš„è¿˜æ˜¯ä»ä»»åŠ¡ä¸­è°ƒç”¨çš„</p>
<p>ç¡®ä¿ä¼ å…¥çš„å‚æ•°éƒ½æ˜¯è¯¥å‡½æ•°ä¼šä½¿ç”¨çš„, åœ¨ä»»åŠ¡ä¸­å’Œä¸­æ–­ä¸­è°ƒç”¨å‡½æ•°æ—¶ä½¿ç”¨çš„apiå‡½æ•°å‚æ•°å¯èƒ½ä¸åŒ</p>
<p>ä¸åŒfreertosç§»æ¤ç‰ˆæœ¬æ‰§è¡Œä¸Šä¸‹æ–‡æœºåˆ¶ä¸åŒ</p>
<p>å…¼å®¹ä¸åŒæ¶æ„, ä¸­æ–­å’Œç¡¬ä»¶æœ‰å…³</p>
<p>ç¼ºç‚¹å‘¢:</p>
<p>åœ¨å¯èƒ½åŒæ—¶è¢«ä¸­æ–­å’Œä»»åŠ¡è°ƒç”¨çš„å‡½æ•°ä¸­æ— æ³•ç¡®å®šä½¿ç”¨å“ªä¸ªå‡½æ•°</p>
<p>è§£å†³åŠæ³•æ˜¯ä½¿ç”¨ å»¶è¿Ÿä¸­æ–­å¤„ç†, å³æŠŠä¸­æ–­å¤„ç†å‡½æ•°ç»Ÿä¸€ç”±ä»»åŠ¡æˆ–è¿›ç¨‹å®ˆæŠ¤ä»»åŠ¡è°ƒç”¨, è€Œè¿™äº›ä»»åŠ¡ç”±ä¸­æ–­è¿›è¡Œå”¤é†’</p>
<p>é‚£ä¹ˆä¸­æ–­å®‰å…¨å‡½æ•°æ˜¯å¦‚ä½•è§£å†³æ— æ³•åœ¨ä¸­æ–­ä¸­åˆ‡æ¢ä¸Šä¸‹æ–‡çš„å‘¢</p>
<p>ä¸­æ–­å®‰å…¨å‡½æ•°éƒ½æœ‰ä¸€ä¸ªç»Ÿä¸€çš„å‚æ•°<code>xHigherPriorityTaskWoken</code></p>
<p>è¿™ä¸ªå‚æ•°æœ‰ä¸¤ä¸ªå€¼, pdTRUEå’ŒpdFALSE</p>
<p>é€šå¸¸åˆå§‹åŒ–ä¸ºpdFALSE</p>
<p>åœ¨æ‰§è¡Œå®Œä¸€ä¸ªapiå‡½æ•°(ä¸­æ–­å®‰å…¨ç‰ˆ)ä¹‹å, å¦‚æœå¯¼è‡´æ›´é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡å˜ä¸ºå°±ç»ªæ€</p>
<p>åˆ™åœ¨apiå‡½æ•°å†…éƒ¨ä¼šå°†è¯¥å‚æ•°æ”¹ä¸ºpdTRUE</p>
<p>æœ€ååœ¨ISRç»“å°¾å¤„é€šè¿‡è°ƒç”¨<code>portYIELD_FROM_ISR( xHigherPriorityTaskWoken )</code>æ¥å†³å®šæ˜¯å¦è·³è½¬</p>
<p><code>portYIELD_FROM_ISR</code>æ˜¯å¦‚ä½•èµ·ä½œç”¨çš„å‘¢?</p>
<p>è¯¥å‡½æ•°ä¼šå…ˆåˆ¤å®šwokenå‚æ•°æ˜¯å¦ä¸ºtrue, å¦‚æœä¸ºtrueåˆ™ä¼šæ‚¬èµ·ä¸€ä¸ªpendSVå¼‚å¸¸</p>
<p>è¿™ä¼šå¯¼è‡´å½“è¯¥ISRæ¨å‡ºå å¼•èµ·ä¸€ä¸ªä¸Šä¸‹æ–‡åˆ‡æ¢</p>
<p>è¿™æ ·å°±é¿å…äº†åœ¨ä¸­æ–­ä¸­è¿›è¡Œä»»åŠ¡åˆ‡æ¢</p>
<p>ç¤ºä¾‹å¦‚ä¸‹, ä½¿ç”¨çš„apiå‡½æ•°ä¸ºäºŒè¿›åˆ¶ä¿¡å·é‡ç›¸å…³å‡½æ•°</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">uint32_t</span> <span class="title function_">ulExampleInterruptHandler</span><span class="params">( <span class="type">void</span> )</span></span><br><span class="line">&#123;</span><br><span class="line">BaseType_t xHigherPriorityTaskWoken;</span><br><span class="line"><span class="comment">/* The xHigherPriorityTaskWoken parameter must be initialized to</span></span><br><span class="line"><span class="comment">pdFALSE as it will get set to pdTRUE inside the interrupt safe</span></span><br><span class="line"><span class="comment">API function if a context switch is required. */</span></span><br><span class="line">xHigherPriorityTaskWoken = pdFALSE;</span><br><span class="line"><span class="comment">/* &#x27;Give&#x27; the semaphore to unblock the task, passing in the address of</span></span><br><span class="line"><span class="comment">xHigherPriorityTaskWoken as the interrupt safe API function&#x27;s</span></span><br><span class="line"><span class="comment">pxHigherPriorityTaskWoken parameter. */</span></span><br><span class="line">xSemaphoreGiveFromISR( xBinarySemaphore, &amp;xHigherPriorityTaskWoken );	<span class="comment">//äºŒè¿›åˆ¶ä¿¡å·é‡</span></span><br><span class="line"><span class="comment">/* Pass the xHigherPriorityTaskWoken value into portYIELD_FROM_ISR().</span></span><br><span class="line"><span class="comment">If xHigherPriorityTaskWoken was set to pdTRUE inside</span></span><br><span class="line"><span class="comment">xSemaphoreGiveFromISR() then calling portYIELD_FROM_ISR() will request</span></span><br><span class="line"><span class="comment">a context switch. If xHigherPriorityTaskWoken is still pdFALSE then</span></span><br><span class="line"><span class="comment">calling portYIELD_FROM_ISR() will have no effect. Unlike most FreeRTOS</span></span><br><span class="line"><span class="comment">ports, the Windows port requires the ISR to return a value - the return</span></span><br><span class="line"><span class="comment">statement is inside the Windows version of portYIELD_FROM_ISR(). */</span></span><br><span class="line">portYIELD_FROM_ISR( xHigherPriorityTaskWoken );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>åœ¨è®²ä¿¡å·é‡ä¹‹å‰å…ˆæ¥äº†è§£ä¸‹å»¶è¿Ÿä¸­æ–­å¤„ç†</p>
<p>ç”±äºISRè¿è¡Œæ—¶ä¼šå¯¼è‡´å†…æ ¸çš„çŸ­æš‚åœæ­¢</p>
<p>è¿™å¯èƒ½ä¼šå¯¼è‡´ ä»»åŠ¡çš„å¼€å§‹æ—¶é—´å’Œæ‰§è¡Œæ—¶é—´çš„æŠ–åŠ¨</p>
<p>æ‰€ä»¥å¿…é¡»ä¿è¯ISRé€»è¾‘å°½é‡ç®€çŸ­</p>
<p>ä½†ä¸–äº‹æ€»ä¸é‚£ä¹ˆå¦‚æ„</p>
<p>åœ¨å¿…é¡»å¤„ç†å¤æ‚é€»è¾‘æ—¶è¯¥æ€ä¹ˆåŠå‘¢</p>
<p>å°±åªèƒ½ä½¿ç”¨å»¶è¿Ÿä¸­æ–­å¤„ç†äº†</p>
<p>å»¶è¿Ÿä¸­æ–­å¤„ç†åœ¨æ£€æµ‹åˆ°ä¸­æ–­æ—¶ å”¤é†’å¤„ç†å‡½æ•°</p>
<p>ç„¶ååœ¨å¤„ç†å‡½æ•°ä¸­è¿›è¡Œé€»è¾‘çš„å¤„ç†</p>
<p>ISRä¸­åªéœ€è¦å†™å”¤é†’å‡½æ•°çš„ä»£ç å³å¯</p>
<p><img src="/../images/FreeRTOS/11.png" alt="11"></p>
<p>é‚£ä¹ˆISRè¦å¦‚ä½•å”¤é†’ä¸€ä¸ªä»»åŠ¡å‘¢</p>
<p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ ä¿¡å·é‡(å®˜æ–¹æ¨èçš„æ˜¯ä½¿ç”¨<strong>ä»»åŠ¡é€šçŸ¥</strong>)</p>
<p>ä¿¡å·é‡åˆ†ä¸ºäºŒè¿›åˆ¶ä¿¡å·é‡å’Œè®¡æ•°ä¿¡å·é‡</p>
<p>äºŒè¿›åˆ¶ä¿¡å·é‡å¯ä»¥çœ‹ä½œä¸€ä¸ªé˜Ÿåˆ—é•¿åº¦ä¸º1çš„, é˜Ÿåˆ—å†…å®¹æ— å…³çš„é˜Ÿåˆ—, é‚£ä¹ˆè®¡æ•°ä¿¡å·é‡å°±æ˜¯é˜Ÿåˆ—é•¿åº¦ä¸ä¸º1çš„, é˜Ÿåˆ—å†…å®¹æ— å…³çš„é˜Ÿåˆ—</p>
<p>ä½¿ç”¨æµç¨‹:</p>
<p>åˆ›å»ºä¸€ä¸ªä¿¡å·é‡</p>
<p>ä¸­æ–­å¤„ç†ä»»åŠ¡ä¸­è°ƒç”¨<strong>take</strong>(è·å–ä¿¡å·é‡å‡½æ•°)</p>
<p>åœ¨takeå‘ç°ä¿¡å·é‡ä¸­æ²¡æœ‰ä¿¡å·æ—¶ è¯¥ä»»åŠ¡è¿›å…¥é˜»å¡çŠ¶æ€</p>
<p>å½“æ£€æµ‹åˆ°ä¸­æ–­å‘ç”Ÿ</p>
<p>ISRä¸­è°ƒç”¨<strong>give</strong>(å†™ä¿¡å·é‡å‡½æ•°)</p>
<p>æ­¤æ—¶å†…æ ¸å‘ç°è¯¥ä¿¡å·é‡æœ‰å€¼äº†, é€šçŸ¥ä¸­æ–­å¤„ç†ä»»åŠ¡è¿›å…¥å°±ç»ªæ€</p>
<p>å¦‚æœä¸­æ–­å¤„ç†ä»»åŠ¡çš„ä¼˜å…ˆçº§å¤§äºç°æœ‰ä»»åŠ¡</p>
<p>åˆ™ä¼šå°†<code>xHigherPriorityTaskWoken</code>ç½®ä¸ºpdTRUE, ç„¶åISRè¿”å›ååˆ‡æ¢ä¸Šä¸‹æ–‡ä¸ºä¸­æ–­å¤„ç†ä»»åŠ¡</p>
<p>ä¸­æ–­å¤„ç†ä»»åŠ¡takeåˆ°ä¿¡å·é‡</p>
<p>æ‰§è¡Œä¸­æ–­å¤„ç†é€»è¾‘</p>
<p>åœ¨ä¸‹ä¸€è½®æ‰§è¡Œæ—¶, takeå†æ¬¡å‘ç°ä¿¡å·é‡ä¸ºç©º, è¿›å…¥é˜»å¡æ€</p>
<p><img src="/../images/FreeRTOS/9.png" alt="9"></p>
<p>äºŒè¿›åˆ¶ä¿¡å·é‡çš„é—®é¢˜ä¹Ÿå¾ˆæ˜æ˜¾</p>
<p>åœ¨å½“ä¸­æ–­å¤„ç†å‡½æ•°takeä¿¡å·é‡ä¹‹å‰ å¦‚æœå†æ¬¡å‘ç”Ÿäº†ä¸€ä¸ªä¸­æ–­</p>
<p>é‚£ä¹ˆç¬¬äºŒä¸ªä¸­æ–­å°†è¢«å¿½ç•¥ äºæ˜¯æœ‰ä¸ªè®¡æ•°ä¿¡å·é‡</p>
<p>ä½œç”¨æœºåˆ¶æ˜¯ç›¸åŒçš„, åªæ˜¯å¤šäº†èƒ½å¤Ÿå¤„ç†å¤šä¸ªä¸­æ–­</p>
<p><img src="/../images/FreeRTOS/10.png" alt="10"></p>
<p>apiå‡½æ•°:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SemaphoreHandle_t <span class="title function_">xSemaphoreCreateBinary</span><span class="params">( <span class="type">void</span> )</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BaseType_t <span class="title function_">xSemaphoreTake</span><span class="params">( SemaphoreHandle_t xSemaphore, TickType_t xTicksToWait</span></span><br><span class="line"><span class="params">)</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BaseType_t <span class="title function_">xSemaphoreGiveFromISR</span><span class="params">( SemaphoreHandle_t xSemaphore,</span></span><br><span class="line"><span class="params">BaseType_t *pxHigherPriorityTaskWoken )</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SemaphoreHandle_t <span class="title function_">xSemaphoreCreateCounting</span><span class="params">( UBaseType_t uxMaxCount,</span></span><br><span class="line"><span class="params">UBaseType_t uxInitialCount )</span>;</span><br></pre></td></tr></table></figure>



<p>ä¸Šæ–‡è¿˜æåˆ°å¯ä»¥å°†ä¸­æ–­å¤„ç†å·¥ä½œå»¶æ—¶ç»™å®ˆæŠ¤è¿›ç¨‹ä»»åŠ¡</p>
<p>ä¼˜ç‚¹åœ¨äº:</p>
<p>èƒ½å¤Ÿé™ä½èµ„æºæµªè´¹ç‡, æ— éœ€ä¸ºæ¯ä¸ªå»¶è¿Ÿä¸­æ–­åˆ›å»ºå•ç‹¬ä»»åŠ¡</p>
<p>ç®€åŒ–ç”¨æˆ·æ¨¡å‹: å»¶è¿Ÿä¸­æ–­å¤„ç†å‡½æ•°æ˜¯ä¸€ä¸ªæ ‡å‡†çš„Cå‡½æ•°</p>
<p>ç¼ºç‚¹åœ¨äº:</p>
<p>ç”±äºéƒ½æ˜¯é€‚ç”¨çš„å®ˆæŠ¤è¿›ç¨‹ä»»åŠ¡, é‚£ä¹ˆæ— æ³•ä¸ºæ¯ä¸ªä¸­æ–­å¤„ç†è®¾ç½®å•ç‹¬çš„ä¼˜å…ˆçº§</p>
<p>å®ˆæŠ¤è¿›ç¨‹æ‰§è¡Œå‡½æ•°æ˜¯é€šè¿‡é˜Ÿåˆ—æ¥è·å–æ‰€éœ€è¦çš„æ‰§è¡Œå‡½æ•°çš„, å¯èƒ½ISRç»“æŸåæ— æ³•ç«‹å³æ‰§è¡Œä¸­æ–­å¤„ç†å‡½æ•°</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">BaseType_t <span class="title function_">xTimerPendFunctionCallFromISR</span><span class="params">( PendedFunction_t</span></span><br><span class="line"><span class="params">xFunctionToPend,</span></span><br><span class="line"><span class="params"><span class="type">void</span> *pvParameter1,</span></span><br><span class="line"><span class="params"><span class="type">uint32_t</span> ulParameter2,</span></span><br><span class="line"><span class="params">BaseType_t *pxHigherPriorityTaskWoken )</span>;	<span class="comment">//åœ¨ä¸­æ–­ä¸­å‘è¿›ç¨‹å®ˆæŠ¤ä»»åŠ¡å‘é€ä¸€ä¸ªå‡½æ•°æ‰§è¡ŒæŒ‡ä»¤</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">vPendableFunction</span><span class="params">( <span class="type">void</span> *pvParameter1, <span class="type">uint32_t</span> ulParameter2 )</span>;	<span class="comment">//å‡½æ•°åŸå‹ æ—¢å¯ä»¥ä½¿ç”¨æŒ‡é’ˆç±»å‹çš„å‚æ•° ä¹Ÿå¯ä»¥ä½¿ç”¨éæŒ‡é’ˆç±»å‹å‚æ•°</span></span><br></pre></td></tr></table></figure>



<p>ISRä¸­ä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨é˜Ÿåˆ—çš„, ä½†å¦‚æœåªæ˜¯ç”¨æ¥ä¼ é€’ä¿¡å· é‚£è¿˜æ˜¯ä¿¡å·é‡ç›¸å¯¹æ›´ä½³(æœ€ä½³çš„è¿˜æ˜¯ ä»»åŠ¡é€šçŸ¥)</p>
<p>åœ¨è¿›ç¨‹ä¸­ä½¿ç”¨é˜Ÿåˆ—ä¹Ÿéœ€è¦ä½¿ç”¨ISRä¸“ç”¨çš„ä¸­æ–­å®‰å…¨apiå‡½æ•°</p>
<p>åœ¨UARTç¨‹åºä¸­, å¯ä»¥ä½¿ç”¨é˜Ÿåˆ—æ¥æ¥æ”¶UARTä¼ é€è¿‡æ¥çš„æ•°æ®, ç„¶åé€šè¿‡å»¶è¿Ÿä¸­æ–­å¤„ç†è®¡æ•° åœ¨ä»»åŠ¡ä¸­è¿›è¡Œå¤„ç†</p>
<p>ä¸­æ–­æ˜¯å¯ä»¥åµŒå¥—çš„</p>
<p>æ¯ä¸ªä¸­æ–­æºéƒ½æœ‰æ•°å€¼ä¼˜å…ˆçº§å’Œé€»è¾‘ä¼˜å…ˆçº§çš„å±æ€§</p>
<p>é€»è¾‘ä¼˜å…ˆçº§é«˜çš„èƒ½æŠ¢å é€»è¾‘ä¼˜å…ˆçº§ä½çš„ä¸­æ–­ è¿™ç‚¹å’Œè£¸æœºä¸€æ ·</p>
<p>é€»è¾‘ä¼˜å…ˆçº§ç”±æ•°å­—ä¼˜å…ˆçº§æ§åˆ¶</p>
<p>åœ¨CM3ä¸­, æ•°å­—ä¼˜å…ˆçº§ä½çš„é€»è¾‘ä¼˜å…ˆçº§è¶Šé«˜, è¿™ç‚¹ä¹Ÿå’Œè£¸æœºä¸€æ ·</p>
<p><img src="/../images/FreeRTOS/12.png" alt="12"></p>
<p>å¯¹äºè¶Šé«˜çš„ä¼˜å…ˆçº§å¯¹ISRçš„æ‰§è¡Œäº‹ä»¶è¶Šä¸¥æ ¼, å…·ä½“è¡¨ç°ä¸ºæ˜¯å¦èƒ½å¤Ÿä½¿ç”¨apiå‡½æ•°</p>
<p>CM3ä¸­æœ€é«˜å¾ªåºä½¿ç”¨8ä½æ¥æŒ‡å®šæ¯ä¸ªä¸­æ–­ä¼˜å…ˆçº§</p>
<p>é€šå¸¸åªä½¿ç”¨å…«ä½æ•°å­—çš„ä¸€éƒ¨åˆ†</p>
<p>ä½¿ç”¨è§„èŒƒåˆ™æ˜¯å·¦å¯¹é½, æœªä½¿ç”¨çš„ä½æœ‰æ•ˆä½é€šå¸¸ç½®ä¸º1</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/12/09/FreeRTOS(%E4%B8%89)-%E8%BD%AF%E4%BB%B6%E5%AE%9A%E6%97%B6%E5%99%A8%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="Sn0r1ax">
      <meta itemprop="description" content="ğŸ˜˜ğŸ˜˜ğŸ˜˜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sn0r1ax">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/12/09/FreeRTOS(%E4%B8%89)-%E8%BD%AF%E4%BB%B6%E5%AE%9A%E6%97%B6%E5%99%A8%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">FreeRTOSå­¦ä¹ ç¬”è®°(ä¸‰) è½¯ä»¶å®šæ—¶å™¨ç®¡ç†</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-12-09 20:32:12" itemprop="dateCreated datePublished" datetime="2025-12-09T20:32:12+08:00">2025-12-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-12-21 16:09:37" itemprop="dateModified" datetime="2025-12-21T16:09:37+08:00">2025-12-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">åµŒå…¥å¼</span></a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/FreeRTOS/" itemprop="url" rel="index"><span itemprop="name">FreeRTOS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="è½¯ä»¶å®šæ—¶å™¨èƒ½å¹²å˜›"><a href="#è½¯ä»¶å®šæ—¶å™¨èƒ½å¹²å˜›" class="headerlink" title="è½¯ä»¶å®šæ—¶å™¨èƒ½å¹²å˜›"></a>è½¯ä»¶å®šæ—¶å™¨èƒ½å¹²å˜›</h2><p>è½¯ä»¶å®šæ—¶å™¨åŠŸèƒ½ä¸Šå’Œç¡¬ä»¶å®šæ—¶å™¨ç±»ä¼¼, ä½†æ˜¯è½¯ä»¶å®šæ—¶å™¨æ˜¯åŸºäºç³»ç»Ÿä¸­æ–­ç”±è½¯ä»¶æ¥æ¨¡æ‹Ÿçš„å®šæ—¶å™¨</p>
<p>ä¸åƒç¡¬ä»¶å®šæ—¶å™¨ä¸€æ ·å ç”¨ç¡¬ä»¶èµ„æº</p>
<p>ä¸ºäº†å¯ç”¨è½¯ä»¶å®šæ—¶å™¨ï¼Œéœ€è¦åœ¨å¤´æ–‡ä»¶<strong>FreeRTOSConfig.h</strong>ä¸­è®¾ç½®<strong>configUSE_TIMERS</strong>çš„å€¼ä¸º1</p>
<p>å’Œç¡¬ä»¶å®šæ—¶å™¨ç›¸åŒ, åœ¨ç»è¿‡è®¾å®šçš„tickæ•°ä¹‹å, ä¼šè°ƒç”¨å¯¹åº”çš„å›è°ƒå‡½æ•°</p>
<p>å¯ä»¥åœ¨å›è°ƒå‡½æ•°ä¸­å®ç°éœ€è¦çš„é€»è¾‘</p>
<p>æ³¨æ„ä¸è¦åœ¨å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œä»»ä½•å¯èƒ½ä¼šå¯¼è‡´å…¶è¿›å…¥é˜»å¡çŠ¶æ€çš„å‡½æ•°</p>
<p>å› ä¸ºå®šæ—¶å™¨å›è°ƒå‡½æ•°æ˜¯ç”±è¿›ç¨‹å®ˆæŠ¤ä»»åŠ¡(RTOS daemon task)æ‰§è¡Œçš„</p>
<p>è¿›ç¨‹å®ˆæŠ¤ä»»åŠ¡å…·æœ‰å’Œæ­£å¸¸ä»»åŠ¡ç›¸åŒçš„ä¼˜å…ˆçº§æœºåˆ¶</p>
<p>ä¸€æ—¦å®šæ—¶å™¨å›è°ƒå‡½æ•°è¿›å…¥é˜»å¡çŠ¶æ€, è¿›ç¨‹å®ˆæŠ¤ä»»åŠ¡ä¹Ÿä¼šè¢«é˜»å¡, è¿™æ˜¯ä¸åˆæ³•çš„</p>
<p>mcuæ€»æ˜¯å•çº¿ç¨‹çš„, é‚£ä¹ˆå®ˆæŠ¤è¿›ç¨‹ä»»åŠ¡ä»€ä¹ˆæ—¶å€™æ‰§è¡Œæ˜¯ç”±è°æ¥ç»´æŠ¤çš„å‘¢?</p>
<p>è¿˜è®°å¾—æ—¶é—´ç‰‡ç»“å°¾çš„ä¸­æ–­å—?</p>
<p>åœ¨è¿™ä¸ªä¸­æ–­çš„æœåŠ¡ä¾‹ç¨‹é‡Œä¼šæ£€æŸ¥æ˜¯å¦æ»¡è¶³å®šæ—¶å™¨çš„æ¡ä»¶</p>
<p>å¦‚æœæ˜¯, åˆ™å”¤é†’å®šæ—¶å™¨, ç´§è·Ÿç€çš„å°±ä¼šæ‰§è¡Œå®šæ—¶å™¨çš„å¤„ç†ä»»åŠ¡äº†</p>
<p>è½¯ä»¶å®šæ—¶å™¨åˆ†ä¸€æ¬¡æ€§å®šæ—¶å™¨å’Œè‡ªåŠ¨é‡è½½å®šæ—¶å™¨</p>
<p>ä¸€æ¬¡æ€§å®šæ—¶å™¨åœ¨è¿è¡Œå®Œä¸€æ¬¡ä¹‹åè‡ªåŠ¨è¿›å…¥ä¼‘çœ (dormant)çŠ¶æ€</p>
<p>è€Œè‡ªåŠ¨é‡è½½å®šæ—¶å™¨åœ¨æ‰§è¡Œå®Œä¸€æ¬¡åä¼šé‡æ–°å¼€å§‹</p>
<p><img src="/../images/FreeRTOS/8.png" alt="8"></p>
<p>æ—¢ç„¶å®šæ—¶å™¨æ˜¯ç”±freertoså®ˆæŠ¤è¿›ç¨‹ä»»åŠ¡ç»´æŠ¤çš„, è€Œå¯åŠ¨å®šæ—¶å™¨ç­‰apiå‡½æ•°æ€»æ˜¯åœ¨åˆ«çš„ä»»åŠ¡ä¸­æ‰§è¡Œçš„</p>
<p>é‚£ä¹ˆå®ˆæŠ¤è¿›ç¨‹ä»»åŠ¡æ˜¯å¦‚ä½•çŸ¥é“åœ¨ä»€ä¹ˆæ—¶å€™å¯åŠ¨å®šæ—¶å™¨, åˆåœ¨ä»€ä¹ˆæ—¶å€™å¯¹å®šæ—¶å™¨è¿›è¡Œæ“ä½œå‘¢</p>
<p>è¿™å°±è¦æåˆ°ä¸Šä¸€èŠ‚çš„é˜Ÿåˆ—äº†</p>
<p>é˜Ÿåˆ—ä½œä¸ºä¸€ç§ä»»åŠ¡é—´çš„é€šä¿¡æ–¹å¼, ç†æ‰€åº”å½“èƒ½å¤Ÿä½œä¸ºè¿›ç¨‹å®ˆæŠ¤ä»»åŠ¡ä¸å…¶ä»–ä»»åŠ¡æ²Ÿé€šçš„æ¡¥æ¢</p>
<p>å½“å…¶ä»–ä»»åŠ¡è°ƒç”¨<code>xTimerCreate()</code>æ—¶, ä¼šå‘Timer Command Queue(å®šæ—¶å™¨ä»»åŠ¡åˆ—è¡¨)ä¸­å‘é€ä¸€æ¡æŒ‡ä»¤</p>
<p>å½“è¿›ç¨‹å®ˆæŠ¤ä»»åŠ¡ä»åˆ—è¡¨ä¸­è¯»å–åˆ°è¯¥æŒ‡ä»¤æ—¶, ä¼šæ‰§è¡Œç›¸åº”çš„æ“ä½œ</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">TimerHandle_t <span class="title function_">xTimerCreate</span><span class="params">( <span class="type">const</span> <span class="type">char</span> * <span class="type">const</span> pcTimerName,	<span class="comment">//å®šæ—¶å™¨å, ä»…ç”¨äºè°ƒè¯•</span></span></span><br><span class="line"><span class="params"><span class="type">const</span> TickType_t xTimerPeriodInTicks,	<span class="comment">//å®šæ—¶å™¨æ—¶é—´(tickæ•°)</span></span></span><br><span class="line"><span class="params"><span class="type">const</span> BaseType_t xAutoReload,	<span class="comment">//æ˜¯å¦è‡ªåŠ¨é‡è½½ pdTRUE/pdFALSE</span></span></span><br><span class="line"><span class="params"><span class="type">void</span> * <span class="type">const</span> pvTimerID,			<span class="comment">//å®šæ—¶å™¨ID, å¯ç”¨äºè‡ªå®šä¹‰æ“ä½œ, å…¶ä»–apiå‡½æ•°æœ¬èº«ä¸ä¼šä½¿ç”¨</span></span></span><br><span class="line"><span class="params">TimerCallbackFunction_t pxCallbackFunction )</span>;	<span class="comment">//å›è°ƒå‡½æ•°æŒ‡é’ˆ</span></span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BaseType_t <span class="title function_">xTimerStart</span><span class="params">( TimerHandle_t xTimer, TickType_t xTicksToWait )</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">vTimerSetTimerID</span><span class="params">( <span class="type">const</span> TimerHandle_t xTimer, <span class="type">void</span> *pvNewID )</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> *<span class="title function_">pvTimerGetTimerID</span><span class="params">( <span class="type">const</span> TimerHandle_t xTimer )</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BaseType_t <span class="title function_">xTimerChangePeriod</span><span class="params">( TimerHandle_t xTimer,</span></span><br><span class="line"><span class="params">TickType_t xNewPeriod,</span></span><br><span class="line"><span class="params">TickType_t xTicksToWait )</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BaseType_t <span class="title function_">xTimerReset</span><span class="params">( TimerHandle_t xTimer, TickType_t xTicksToWait )</span>;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°apiå‡½æ•°å¦‚è‹¥è¦åœ¨ä¸­æ–­ä¸­ä½¿ç”¨, å‡éœ€è¦ä½¿ç”¨å…¶ä¸­æ–­ä¸“ç”¨apiå‡½æ•°, å‡½æ•°åå°±æ˜¯åŸå‡½æ•°ååé¢åŠ ä¸ŠFromISR</p>
<p>ä¾‹å¦‚<code>xTimerStartFromISR()</code></p>
<p>é™æ€åˆ›å»ºè½¯ä»¶å®šæ—¶å™¨<code>xTimerCreateStatic()</code></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/12/08/FreeRTOS(%E4%BA%8C)-%E9%98%9F%E5%88%97%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="Sn0r1ax">
      <meta itemprop="description" content="ğŸ˜˜ğŸ˜˜ğŸ˜˜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sn0r1ax">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/12/08/FreeRTOS(%E4%BA%8C)-%E9%98%9F%E5%88%97%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">FreeRTOSå­¦ä¹ ç¬”è®°(äºŒ) é˜Ÿåˆ—ç®¡ç†</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-12-08 21:28:02" itemprop="dateCreated datePublished" datetime="2025-12-08T21:28:02+08:00">2025-12-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-12-16 22:44:47" itemprop="dateModified" datetime="2025-12-16T22:44:47+08:00">2025-12-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">åµŒå…¥å¼</span></a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/FreeRTOS/" itemprop="url" rel="index"><span itemprop="name">FreeRTOS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="ä»€ä¹ˆæ˜¯é˜Ÿåˆ—"><a href="#ä»€ä¹ˆæ˜¯é˜Ÿåˆ—" class="headerlink" title="ä»€ä¹ˆæ˜¯é˜Ÿåˆ—"></a>ä»€ä¹ˆæ˜¯é˜Ÿåˆ—</h2><p>ç”¨äºä»»åŠ¡ä¸ä»»åŠ¡ä¹‹é—´, ä¸­æ–­ä¸ä¸­æ–­ä¹‹é—´, ä»»åŠ¡ä¸ä¸­æ–­ä¸­é—´é€šä¿¡çš„ä¸€ç§æ–¹å¼</p>
<p>é˜Ÿåˆ—æœ¬èº«ä¹Ÿæ˜¯ä¸€ç§FIFOçš„æ•°æ®ç»“æ„</p>
<p>ä½¿ç”¨èµ·æ¥ä¹Ÿæ˜¯å¦‚æ­¤, é€šè¿‡<code>xQueueSend()</code>apiå‡½æ•°å°†æ•°æ®å‘é€åˆ°é˜Ÿåˆ—ä¸­</p>
<p>å¯ä»¥é€‰æ‹©æ˜¯ä»¥æ‹·è´çš„å½¢å¼è¿˜æ˜¯ä»¥æŒ‡é’ˆçš„å½¢å¼å­˜æ”¾äºé˜Ÿåˆ—ä¸­</p>
<p>å°†æ•°æ®å‘é€è¿›é˜Ÿåˆ—çš„æ—¶å€™å¯ä»¥é€‰æ‹©æ˜¯å‘é€åˆ°é˜Ÿé¦–è¿˜æ˜¯é˜Ÿå°¾</p>
<p>é˜Ÿåˆ—çš„è¯»å–æ€»æ˜¯ä»é˜Ÿé¦–è¯»å–æ•°æ®</p>
<p>ä¸ºäº†å¤„ç†å¤šä»»åŠ¡é—´é€šä¿¡çš„é—®é¢˜</p>
<p>å¯ä»¥ç”¨ç»“æ„ä½“æ¥å‚¨å­˜æ•°æ®</p>
<p>ç»“æ„ä½“ä¸­æ ‡æ˜è¯¥ä¿¡æ¯çš„æ¥æºåŠæ•°æ®æœ¬èº«</p>
<p>è¿˜å¯ä»¥ä½¿ç”¨é˜Ÿåˆ—é›†(Queue Set)çš„æ–¹å¼</p>
<p>ä¸è¿‡é˜Ÿåˆ—é›†ç›¸è¾ƒäºç»“æ„ä½“æ›´ä¸ç›´è§‚ä¸”æ•ˆç‡æ›´å·®</p>
<p>å› æ­¤å®˜æ–¹æ›´æ¨èåœ¨å¯é€‰çš„æƒ…å†µä¸‹ä½¿ç”¨ç»“æ„ä½“çš„æ–¹å¼</p>
<p>è¯´å›é˜Ÿåˆ—é›†</p>
<p>é˜Ÿåˆ—é›†å°±æ˜¯å¤šä¸ªé˜Ÿåˆ—(æˆ–ä¿¡å·é‡)çš„é›†åˆ</p>
<p>å½“å¤„äºé˜Ÿåˆ—é›†ä¸­çš„é˜Ÿåˆ—æ”¶åˆ°æ•°æ®æ—¶, è¯¥é˜Ÿåˆ—ä¼šå°†å…¶å¥æŸ„å‘é€åˆ°é˜Ÿåˆ—é›†ä¸­, æ­¤æ—¶é˜Ÿåˆ—é›†ä¸­å°±æœ‰æ•°æ®äº†</p>
<p>é€šè¿‡<code>xQueueSelectFromSet()</code>å‡½æ•°ä¼ å…¥é˜Ÿåˆ—é›†çš„å¥æŸ„, ä»¥æ­¤æ¥è¿”å›é˜Ÿåˆ—é›†ä¸­å­˜åœ¨çš„é˜Ÿåˆ—å¥æŸ„</p>
<p>åœ¨å®é™…ä½¿ç”¨æ—¶å¯ä»¥é€šè¿‡è¿”å›çš„å¥æŸ„ä¸ç°æœ‰çš„å¥æŸ„è¿›è¡Œæ¯”è¾ƒ</p>
<p>æ ¹æ®ä¸åŒä»»åŠ¡çš„æ•°æ®é€‰æ‹©ä¸åŒçš„å¤„ç†å‡½æ•°</p>
<p>è¿˜æœ‰ä¸€ç§å«åš<strong>Mailbox</strong>çš„ç”¨æ³•</p>
<p>åœ¨è¿™é‡Œ, MailboxæŒ‡çš„æ˜¯é˜Ÿåˆ—é•¿åº¦ä¸º1çš„é˜Ÿåˆ—</p>
<p>Mailboxçš„æ„æ€æ˜¯åƒé‚®ä¸€æ ·åªå‚¨å­˜ä¸€ä¸ªæ•°æ®, å‘é€æ•°æ®åˆ°è¯¥é˜Ÿåˆ—æ—¶ç›´æ¥è¦†å†™, è€Œä¸æ˜¯ç­‰å¾…è¢«æ¥æ”¶æ–¹è¯»å–å¹¶åˆ é™¤ å¯¹åº”apiå‡½æ•°ä¸º<code>xQueueOverwrite()</code> è¯¥å‡½æ•°åªèƒ½ç”¨äºé˜Ÿåˆ—é•¿åº¦ä¸º1çš„é˜Ÿåˆ—</p>
<p>æ¥å—æ—¶ä¹Ÿä¸è¿›è¡Œåˆ é™¤, è€Œæ˜¯ç›´æ¥è·å¾—ä¸€ä»½æ‹·è´ ç›¸å…³apiå‡½æ•°ä¸º<code>xQueuePeek()</code></p>
<h2 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h2><p><strong>Mastering-the-FreeRTOS-Real-Time-Kernel.v1.1.0 (Richard Barry -and- The FreeRTOS Team)</strong></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/12/03/FreeRTOS(%E4%B8%80)-%E4%BB%BB%E5%8A%A1%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="Sn0r1ax">
      <meta itemprop="description" content="ğŸ˜˜ğŸ˜˜ğŸ˜˜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sn0r1ax">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/12/03/FreeRTOS(%E4%B8%80)-%E4%BB%BB%E5%8A%A1%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">FreeRTOSå­¦ä¹ ç¬”è®°(ä¸€) ä»»åŠ¡ç®¡ç†</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-12-03 20:07:37" itemprop="dateCreated datePublished" datetime="2025-12-03T20:07:37+08:00">2025-12-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-12-09 20:13:33" itemprop="dateModified" datetime="2025-12-09T20:13:33+08:00">2025-12-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">åµŒå…¥å¼</span></a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/FreeRTOS/" itemprop="url" rel="index"><span itemprop="name">FreeRTOS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="ä»€ä¹ˆæ˜¯ä»»åŠ¡"><a href="#ä»€ä¹ˆæ˜¯ä»»åŠ¡" class="headerlink" title="ä»€ä¹ˆæ˜¯ä»»åŠ¡"></a>ä»€ä¹ˆæ˜¯ä»»åŠ¡</h2><p>åœ¨ FreeRTOS ä¸­ï¼Œ<strong>ä»»åŠ¡ï¼ˆTaskï¼‰æ˜¯å†…æ ¸è°ƒåº¦çš„åŸºæœ¬æ‰§è¡Œå•ä½</strong>ã€‚<br> å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç‹¬ç«‹è¿è¡Œçš„å‡½æ•°ï¼Œå¹¶ä¸”æ‹¥æœ‰è‡ªå·±çš„è¿è¡Œç¯å¢ƒã€‚</p>
<p>FreeRTOS ä¸ºæ¯ä¸ªä»»åŠ¡åˆ†é…ä¸¤å—ç‹¬ç«‹çš„å†…å­˜ï¼š</p>
<ul>
<li><strong>TCBï¼ˆTask Control Blockï¼‰</strong>ï¼šä¿å­˜ä»»åŠ¡çš„å…ƒä¿¡æ¯ï¼Œä¾‹å¦‚ä¼˜å…ˆçº§ã€çŠ¶æ€ã€ä¸Šä¸‹æ–‡æŒ‡é’ˆç­‰ã€‚</li>
<li><strong>ä»»åŠ¡æ ˆï¼ˆStackï¼‰</strong>ï¼šä¿å­˜æ­¤ä»»åŠ¡çš„å±€éƒ¨å˜é‡ã€å‡½æ•°è°ƒç”¨ç°åœºå’Œå¯„å­˜å™¨ä¸Šä¸‹æ–‡ã€‚</li>
</ul>
<p>ä»»åŠ¡ä¹‹é—´çš„æ ˆç©ºé—´ç›¸äº’ç‹¬ç«‹ï¼Œå› æ­¤æ¯ä¸ªä»»åŠ¡å¯ä»¥åƒâ€œå•ç‹¬è¿è¡Œâ€çš„ç¨‹åºä¸€æ ·æ‰§è¡Œè‡ªå·±çš„é€»è¾‘ã€‚</p>
<p>è™½ç„¶å•æ ¸ MCU åœ¨ä»»æ„æ—¶åˆ»åªèƒ½æ‰§è¡Œä¸€æ¡æŒ‡ä»¤ï¼Œä½† FreeRTOS é€šè¿‡<strong>ä¼˜å…ˆçº§è°ƒåº¦</strong>å’Œ<strong>å¿«é€Ÿçš„ä¸Šä¸‹æ–‡åˆ‡æ¢</strong>è®©å¤šä¸ªä»»åŠ¡â€œè½®æµè¿è¡Œâ€ï¼Œä»è€Œè¡¨ç°å‡ºç±»ä¼¼å¤šçº¿ç¨‹çš„æ•ˆæœã€‚</p>
<blockquote>
<p><strong>å› æ­¤ï¼Œä»»åŠ¡å¯ä»¥ç†è§£ä¸ºï¼šFreeRTOS ä¸­ç”±è°ƒåº¦å™¨ç®¡ç†çš„ç‹¬ç«‹æ‰§è¡Œå•å…ƒï¼Œæ˜¯æ•´ä¸ªç³»ç»Ÿä¸­æœ€å°çš„å¯è°ƒåº¦å¯¹è±¡ã€‚</strong></p>
</blockquote>
<p>ä¸€ä¸ªæœ€ç®€å•çš„ä»»åŠ¡é•¿è¿™æ ·</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">StartDefaultTask</span><span class="params">(<span class="type">void</span> *argument)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">/* Infinite loop */</span></span><br><span class="line">  <span class="keyword">for</span>(;;)</span><br><span class="line">  &#123;</span><br><span class="line">      </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="ä»»åŠ¡çš„çŠ¶æ€æœºåŠå…¶ç”Ÿå‘½å‘¨æœŸ"><a href="#ä»»åŠ¡çš„çŠ¶æ€æœºåŠå…¶ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ä»»åŠ¡çš„çŠ¶æ€æœºåŠå…¶ç”Ÿå‘½å‘¨æœŸ"></a>ä»»åŠ¡çš„çŠ¶æ€æœºåŠå…¶ç”Ÿå‘½å‘¨æœŸ</h2><p>ä¸€ä¸ªä»»åŠ¡åŒ…å«å››ç§çŠ¶æ€, åˆšåˆ›å»ºæ—¶çš„<strong>å°±ç»ªæ€(Ready)</strong>, æ‰§è¡Œæ—¶çš„<strong>è¿è¡Œæ€(Runing)</strong>, é˜»å¡æ—¶çš„<strong>é˜»å¡æ€(Blocked)</strong>, æš‚åœæ—¶çš„<strong>æŒ‚èµ·æ€(Suspended)</strong></p>
<p>å½“ç„¶è¿˜æœ‰è¢«<strong>delete</strong>åçš„çŠ¶æ€, è¿™é‡Œä¸åˆ—å…¥å…¶ä¸­</p>
<h3 id="å¦‚ä½•åˆ›å»ºä¸€ä¸ªä»»åŠ¡"><a href="#å¦‚ä½•åˆ›å»ºä¸€ä¸ªä»»åŠ¡" class="headerlink" title="å¦‚ä½•åˆ›å»ºä¸€ä¸ªä»»åŠ¡"></a>å¦‚ä½•åˆ›å»ºä¸€ä¸ªä»»åŠ¡</h3><h4 id="å‡½æ•°å‚æ•°åŠè¿”å›å€¼"><a href="#å‡½æ•°å‚æ•°åŠè¿”å›å€¼" class="headerlink" title="å‡½æ•°å‚æ•°åŠè¿”å›å€¼"></a>å‡½æ•°å‚æ•°åŠè¿”å›å€¼</h4><p>FreeRTOSæä¾›äº†6ä¸ªapiå‡½æ•°ä¾›æˆ‘ä»¬ä½¿ç”¨, åˆ†åˆ«æ˜¯:</p>
<p><code>xTaskCreate(), xTaskCreateStatic(),xTaskCreateRestricted(), xTaskCreateRestrictedStatic(), xTaskCreateAffinitySet(), and xTaskCreateStaticAffinitySet()</code></p>
<p>å…¶ä¸­æœ€åŸºç¡€çš„æ˜¯<code>xTaskCreate()</code>, å‡½æ•°å®šä¹‰å¦‚ä¸‹:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">BaseType_t <span class="title function_">xTaskCreate</span><span class="params">( TaskFunction_t pvTaskCode,</span></span><br><span class="line"><span class="params"><span class="type">const</span> <span class="type">char</span> * <span class="type">const</span> pcName,</span></span><br><span class="line"><span class="params">configSTACK_DEPTH_TYPE usStackDepth,</span></span><br><span class="line"><span class="params"><span class="type">void</span> * pvParameters,</span></span><br><span class="line"><span class="params">UBaseType_t uxPriority,</span></span><br><span class="line"><span class="params">TaskHandle_t * pxCreatedTask )</span>;</span><br></pre></td></tr></table></figure>

<p>å¦å¤–æä¸€å˜´, FreeRTOSè¿™ä¸ªé¡¹ç›®ä½¿ç”¨çš„å‘½åæ–¹æ³•å¯ä»¥çœ‹ä½œæ˜¯ä¸€ç§<strong>åŒˆç‰™åˆ©å‘½åæ³•çš„å˜ä½“</strong>, é€šè¿‡åœ¨å˜é‡åå‰åŠ â€™iâ€™, â€˜uâ€™ ä¹‹ç±»çš„å•è¯è¡¨ç¤ºå˜é‡çš„ç±»å‹</p>
<p>å¦‚uxPriority å°±æ˜¯æŒ‡çš„unsigned basetype (basetypeåœ¨ä¸åŒçš„æ¶æ„ä¸Šä½æ•°ä¸åŒ, å¦‚32ä½æ¶æ„ä¸‹æ˜¯32ä½, 64ä½ä¸‹åˆ™æ˜¯64ä½)</p>
<p>è¯è¯´å›æ¥, ä»‹ç»ä¸€ä¸‹å…¶ä¸­çš„å‚æ•°åŠè¿”å›å€¼</p>
<p><strong>å‚æ•°:</strong></p>
<ul>
<li>pvTaskCode: è¯¥å‚æ•°ä¸ºæŒ‡å‘ä»»åŠ¡çš„å‡½æ•°çš„æŒ‡é’ˆ</li>
<li>pcName: ç”¨äºè°ƒè¯•æ—¶æ˜¾ç¤ºçš„ä»»åŠ¡åç§°, å¯ç½®NULL, <code>configMAX_TASK_NAME_LEN</code>è®°å½•äº†å…¶æœ€å¤§é•¿åº¦</li>
<li>usStackDepth: ç”¨äºæŒ‡å®šåˆ†é…ç»™ä»»åŠ¡ä½¿ç”¨çš„å †æ ˆå¤§å°, è¯¥å€¼æŒ‡å®šçš„æ˜¯å †æ ˆå¯å®¹çº³çš„å­—èŠ‚æ•°, å³ å¦‚æœè¯¥å‚æ•°ä¸º128, åˆ™ä¼šåˆ†é…128 * 4 ä¸ªå­—èŠ‚çš„å †æ ˆç©ºé—´. <code>configSTACK_DEPTH_TYPE</code>è§„å®šäº†ç”¨äºä¿å­˜å †æ ˆå¤§å°çš„æ•°æ®ç±»å‹, é»˜è®¤ä¸º<code>uint16_t</code>, æ„å‘³ç€å¦‚æœå †æ ˆæ·±åº¦ä¹˜ä»¥å †æ ˆå®½åº¦å¤§äº65535æ—¶ä¼šå‘ç”Ÿæº¢å‡º</li>
<li>pvParameters: ç”¨äºç»™ä»»åŠ¡çš„å‚æ•°ä¼ å€¼</li>
<li>uxPriority: è¯¥ä»»åŠ¡çš„ä¼˜å…ˆçº§, èŒƒå›´ä¸º0åˆ°<code>configMAX_PRIORITIES - 1</code></li>
<li>pxCreatedTask: ç”¨äºå‚¨å­˜è¯¥ä»»åŠ¡çš„å¥æŸ„, å¯ç½®NULL</li>
</ul>
<p><strong>è¿”å›å€¼:</strong></p>
<ul>
<li>pdPASS: æ ‡å¿—ç€ä»»åŠ¡è¢«æˆåŠŸåˆ›å»º</li>
<li>pdFAIL: è¡¨æ˜æ²¡æœ‰è¶³å¤Ÿçš„å †å†…å­˜åˆ›å»ºä»»åŠ¡</li>
</ul>
<h4 id="ä¸åŒçš„ä»»åŠ¡åˆ›å»ºå‡½æ•°"><a href="#ä¸åŒçš„ä»»åŠ¡åˆ›å»ºå‡½æ•°" class="headerlink" title="ä¸åŒçš„ä»»åŠ¡åˆ›å»ºå‡½æ•°"></a>ä¸åŒçš„ä»»åŠ¡åˆ›å»ºå‡½æ•°</h4><p>ä»å¦å¤–äº”ä¸ªå‡½æ•°ä¸­å¯ä»¥æå–å‡ºè¿™å‡ ä¸ªå…³é”®è¯, <strong>static</strong>, <strong>Restricted</strong>, <strong>AffinitySet</strong></p>
<p>å…¶ä¸­:</p>
<ul>
<li>staticè¡¨ç¤ºä½¿ç”¨é™æ€çš„å†…å­˜, å’Œcè¯­è¨€ä¸­staticä¸€ä¸ªä½œç”¨, ä¸å¤šèµ˜è¿°</li>
<li>restrictedè¡¨ç¤ºåˆ›å»ºçš„ä»»åŠ¡çš„æƒé™å—åˆ°é™åˆ¶, æ— æ³•è®¿é—®ç³»ç»Ÿå†…å­˜</li>
<li>affinityè¡¨ç¤ºå¯ç”¨äºå¤šæ ¸å¤„ç†å™¨çš„ä»»åŠ¡, æ”¯æŒSymmetric Multi Processing(SMP)</li>
</ul>
<h4 id="åˆ›å»ºä»»åŠ¡çš„ä¸åŒå§¿åŠ¿"><a href="#åˆ›å»ºä»»åŠ¡çš„ä¸åŒå§¿åŠ¿" class="headerlink" title="åˆ›å»ºä»»åŠ¡çš„ä¸åŒå§¿åŠ¿"></a>åˆ›å»ºä»»åŠ¡çš„ä¸åŒå§¿åŠ¿</h4><p>ç®€å•çš„åˆ›å»ºå‡ ä¸ªä»»åŠ¡</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">( <span class="type">void</span> )</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * Variables declared here may no longer exist after starting the FreeRTOS</span></span><br><span class="line"><span class="comment">    * scheduler. Do not attempt to access variables declared on the stack used</span></span><br><span class="line"><span class="comment">    * by main() from tasks.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * Create one of the two tasks. Note that a real application should check</span></span><br><span class="line"><span class="comment">    * the return value of the xTaskCreate() call to ensure the task was</span></span><br><span class="line"><span class="comment">    * created successfully.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    xTaskCreate( vTask1, <span class="comment">/* Pointer to the function that implements the task.*/</span></span><br><span class="line">    <span class="string">&quot;Task 1&quot;</span>,<span class="comment">/* Text name for the task. */</span></span><br><span class="line">    <span class="number">1000</span>, <span class="comment">/* Stack depth in words. */</span></span><br><span class="line">    <span class="literal">NULL</span>, <span class="comment">/* This example does not use the task parameter. */</span></span><br><span class="line">    <span class="number">1</span>, <span class="comment">/* This task will run at priority 1. */</span></span><br><span class="line">    <span class="literal">NULL</span> ); <span class="comment">/* This example does not use the task handle. */</span></span><br><span class="line">    <span class="comment">/* Create the other task in exactly the same way and at the same priority.*/</span></span><br><span class="line">    xTaskCreate( vTask2, <span class="string">&quot;Task 2&quot;</span>, <span class="number">1000</span>, <span class="literal">NULL</span>, <span class="number">1</span>, <span class="literal">NULL</span> );</span><br><span class="line">    <span class="comment">/* Start the scheduler so the tasks start executing. */</span></span><br><span class="line">    vTaskStartScheduler();</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * If all is well main() will not reach here because the scheduler will now</span></span><br><span class="line"><span class="comment">    * be running the created tasks. If main() does reach here then there was</span></span><br><span class="line"><span class="comment">    * not enough heap memory to create either the idle or timer tasks</span></span><br><span class="line"><span class="comment">    * (described later in this book). Chapter 3 provides more information on</span></span><br><span class="line"><span class="comment">    * heap memory management.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">for</span>( ;; );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ªä»»åŠ¡ä¸æ­¢èƒ½åœ¨<code>main</code>å‡½æ•°é‡Œåˆ›å»º, è¿˜å¯ä»¥åœ¨ä»»åŠ¡ä¹‹ä¸­è¿›è¡Œä»»åŠ¡çš„åˆ›å»º</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">vTask1</span><span class="params">( <span class="type">void</span> * pvParameters )</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *pcTaskName = <span class="string">&quot;Task 1 is running\r\n&quot;</span>;</span><br><span class="line">    <span class="keyword">volatile</span> <span class="type">unsigned</span> <span class="type">long</span> ul; <span class="comment">/* volatile to ensure ul is not optimized away. */</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * If this task code is executing then the scheduler must already have</span></span><br><span class="line"><span class="comment">    * been started. Create the other task before entering the infinite loop.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    xTaskCreate( vTask2, <span class="string">&quot;Task 2&quot;</span>, <span class="number">1000</span>, <span class="literal">NULL</span>, <span class="number">1</span>, <span class="literal">NULL</span> );</span><br><span class="line">    <span class="keyword">for</span>( ;; )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/* Print out the name of this task. */</span></span><br><span class="line">        vPrintLine( pcTaskName );</span><br><span class="line">        <span class="comment">/* Delay for a period. */</span></span><br><span class="line">        <span class="keyword">for</span>( ul = <span class="number">0</span>; ul &lt; mainDELAY_LOOP_COUNT; ul++ )</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">            * This loop is just a very crude delay implementation. There is</span></span><br><span class="line"><span class="comment">            * nothing to do in here. Later examples will replace this crude</span></span><br><span class="line"><span class="comment">            * loop with a proper delay/sleep function.</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä»»åŠ¡æ¨¡æ¿è¿›è¡Œå®ä¾‹çš„åˆ›å»º</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">vTaskFunction</span><span class="params">( <span class="type">void</span> * pvParameters )</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> *pcTaskName;</span><br><span class="line">    <span class="keyword">volatile</span> <span class="type">unsigned</span> <span class="type">long</span> ul; <span class="comment">/* volatile to ensure ul is not optimized away. */</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * The string to print out is passed in via the parameter. Cast this to a</span></span><br><span class="line"><span class="comment">    * character pointer.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    pcTaskName = ( <span class="type">char</span> * ) pvParameters;</span><br><span class="line">    <span class="comment">/* As per most tasks, this task is implemented in an infinite loop. */</span></span><br><span class="line">    <span class="keyword">for</span>( ;; )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/* Print out the name of this task. */</span></span><br><span class="line">        vPrintLine( pcTaskName );</span><br><span class="line">        <span class="comment">/* Delay for a period. */</span></span><br><span class="line">        <span class="keyword">for</span>( ul = <span class="number">0</span>; ul &lt; mainDELAY_LOOP_COUNT; ul++ )</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        * This loop is just a very crude delay implementation. There is</span></span><br><span class="line"><span class="comment">        * nothing to do in here. Later exercises will replace this crude</span></span><br><span class="line"><span class="comment">        * loop with a proper delay/sleep function.</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* Define the strings that will be passed in as the task parameters. These are</span></span><br><span class="line"><span class="comment">* defined const and not on the stack used by main() to ensure they remain</span></span><br><span class="line"><span class="comment">* valid when the tasks are executing.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> * pcTextForTask1 = <span class="string">&quot;Task 1 is running&quot;</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> * pcTextForTask2 = <span class="string">&quot;Task 2 is running&quot;</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">( <span class="type">void</span> )</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * Variables declared here may no longer exist after starting the FreeRTOS</span></span><br><span class="line"><span class="comment">    * scheduler. Do not attempt to access variables declared on the stack used</span></span><br><span class="line"><span class="comment">    * by main() from tasks.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="comment">/* Create one of the two tasks. */</span></span><br><span class="line">    xTaskCreate( vTaskFunction, <span class="comment">/* Pointer to the function that implements the task. */</span></span><br><span class="line">    <span class="string">&quot;Task 1&quot;</span>, <span class="comment">/* Text name for the task. This is to facilitate debugging only. */</span></span><br><span class="line">    <span class="number">1000</span>, <span class="comment">/* Stack depth - small  microcontrollers will use much less stack than this.*/</span></span><br><span class="line">    ( <span class="type">void</span> * ) pcTextForTask1, <span class="comment">/* Pass the text to be printed into the task using the task parameter.*/</span></span><br><span class="line">    <span class="number">1</span>, <span class="comment">/* This task will run at priority 1.*/</span></span><br><span class="line">    <span class="literal">NULL</span> ); <span class="comment">/* The task handle is not used in this example. */</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * Create the other task in exactly the same way. Note this time that</span></span><br><span class="line"><span class="comment">    * multiple tasks are being created from the SAME task implementation</span></span><br><span class="line"><span class="comment">    * (vTaskFunction). Only the value passed in the parameter is different.</span></span><br><span class="line"><span class="comment">    * Two instances of the same task definition are being created.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    xTaskCreate( vTaskFunction,</span><br><span class="line">    <span class="string">&quot;Task 2&quot;</span>,</span><br><span class="line">    <span class="number">1000</span>,</span><br><span class="line">    ( <span class="type">void</span> * ) pcTextForTask2,</span><br><span class="line">    <span class="number">1</span>,</span><br><span class="line">    <span class="literal">NULL</span> );</span><br><span class="line">    <span class="comment">/* Start the scheduler so the tasks start executing. */</span></span><br><span class="line">    vTaskStartScheduler();</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * If all is well main() will not reach here because the scheduler will</span></span><br><span class="line"><span class="comment">    * now be running the created tasks. If main() does reach here then there</span></span><br><span class="line"><span class="comment">    * was not enough heap memory to create either the idle or timer tasks</span></span><br><span class="line"><span class="comment">    * (described later in this book). Chapter 3 provides more information on</span></span><br><span class="line"><span class="comment">    * heap memory management.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">for</span>( ;; )</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å››ç§çŠ¶æ€"><a href="#å››ç§çŠ¶æ€" class="headerlink" title="å››ç§çŠ¶æ€"></a>å››ç§çŠ¶æ€</h3><h4 id="å°±ç»ªæ€å’Œè¿è¡Œæ€"><a href="#å°±ç»ªæ€å’Œè¿è¡Œæ€" class="headerlink" title="å°±ç»ªæ€å’Œè¿è¡Œæ€"></a>å°±ç»ªæ€å’Œè¿è¡Œæ€</h4><p>é‚£ä¹ˆåˆ›å»ºå®Œä¸€ä¸ªä»»åŠ¡ä¹‹å, å…¶é»˜è®¤ä¼šå¤„äº<strong>å°±ç»ªæ€</strong></p>
<p>é‚£ä¹ˆæœ‰äº†<strong>å°±ç»ªæ€</strong>, æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä»»åŠ¡è‚¯å®šæƒ³è¦è®©ä»–æ‰§è¡Œ, äºæ˜¯æœ‰äº†<strong>è¿è¡Œæ€</strong></p>
<p>è¿è¡Œå®Œæ¯•çš„ä»»åŠ¡å›åˆ°å°±ç»ªæ€, ç„¶åä»å°±ç»ªæ€ä¸­é€‰ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œ, é‚£ä¹ˆæœ€ç®€å•çš„ä¸€ä¸ªæ¨¡å‹è¯ç”Ÿäº†</p>
<p><img src="/../images/FreeRTOS/0.png" alt="0"></p>
<p>è¿™é‡Œæä¸€å˜´ä¼˜å…ˆçº§, é¡¾åæ€ä¹‰, ä¼˜å…ˆçº§å†³å®šäº†å“ªä¸ªä»»åŠ¡èƒ½å¤Ÿå…ˆæ‰§è¡Œ</p>
<p>ä¸Šæ–‡è¿˜è¯´åˆ°, freertosé€šè¿‡ä¸æ–­åœ°ä¸Šä¸‹æ–‡åˆ‡æ¢è¾¾åˆ°â€ä¼ªâ€å¤šçº¿ç¨‹çš„ç›®çš„</p>
<p>é‚£ä¹ˆåœ¨æ¯æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ—¶å€™éƒ½ä¼šæ ¹æ®ä¼˜å…ˆçº§å†³å®šè°ä¼šè¢«é€‰ä¸­ä¸ºä¸‹ä¸€ä¸ªè¿è¡Œçš„ä»»åŠ¡</p>
<p>è¯•æƒ³ä»¥ä¸‹åœºæ™¯: æˆ‘ä»¬ç°åœ¨æœ‰ä¸¤ä¸ªä¼˜å…ˆçº§ä¸åŒçš„ä»»åŠ¡, è¯·é—®è¿™ä¸¤ä¸ªä»»åŠ¡ä¼šå¦‚ä½•æ‰§è¡Œ?</p>
<p>ç­”æ¡ˆæ˜¾è€Œæ˜“è§, ä½ä¼˜å…ˆçº§çš„ä»»åŠ¡ä¼šè¢«é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡<strong>é¥¿æ­»</strong></p>
<p>é‚£ä¹ˆæˆ‘ä»¬ä¸¤ä¸ªçŠ¶æ€çš„æ¨¡å‹å°±ä¸å¤Ÿç”¨äº†</p>
<p>äºæ˜¯è¯ç”Ÿäº†<strong>é˜»å¡æ€</strong>å’Œ<strong>æŒ‚èµ·æ€</strong></p>
<h4 id="é˜»å¡æ€å’ŒæŒ‚èµ·æ€"><a href="#é˜»å¡æ€å’ŒæŒ‚èµ·æ€" class="headerlink" title="é˜»å¡æ€å’ŒæŒ‚èµ·æ€"></a>é˜»å¡æ€å’ŒæŒ‚èµ·æ€</h4><p>å½“æä¼˜å…ˆçº§çš„ä»»åŠ¡è¿›å…¥é˜»å¡æ€å, é‚£ä¹ˆå°±ç»ªæ€å°±åªå‰©ä¸‹ä½ä¼˜å…ˆçº§çš„ä»»åŠ¡å¯ä»¥æ‰§è¡Œäº†</p>
<p>è¿™æ ·, ä½ä¼˜å…ˆçº§çš„ä»»åŠ¡å°±é¥¿ä¸æ­»äº†</p>
<p><strong>é˜»å¡æ€</strong>åˆ†ä¸ºä¸¤ç§ç±»å‹:</p>
<p><strong>æ—¶é—´(Temporal)äº‹ä»¶</strong>å’Œ<strong>åŒæ­¥(Synchronization)äº‹ä»¶</strong></p>
<p><strong>åŒæ­¥äº‹ä»¶</strong>å¯ç”±FreeRTOS é˜Ÿåˆ—ã€äºŒè¿›åˆ¶ä¿¡å·é‡ã€è®¡æ•°ä¿¡å·é‡ã€äº’æ–¥ä½“ã€é€’å½’äº’æ–¥ä½“ã€äº‹ä»¶ç»„ã€æµç¼“å†²åŒºã€æ¶ˆæ¯ç¼“å†²åŒºå’Œç›´æ¥ä»»åŠ¡é€šçŸ¥äº§ç”Ÿ</p>
<p>ä»»åŠ¡å¯ä»¥é˜»å¡åŒæ­¥äº‹ä»¶å¹¶è®¾ç½®è¶…æ—¶ï¼Œä»è€Œæœ‰æ•ˆåœ°åŒæ—¶é˜»å¡ä¸¤ç§ç±»å‹çš„äº‹ä»¶ã€‚ä¾‹å¦‚ï¼Œä»»åŠ¡å¯ä»¥é€‰æ‹©ç­‰å¾…æœ€å¤š 10 æ¯«ç§’ä»¥ä¾¿æ•°æ®åˆ°è¾¾é˜Ÿåˆ—ã€‚å¦‚æœ 10 æ¯«ç§’å†…æœ‰æ•°æ®åˆ°è¾¾æˆ– 10 æ¯«ç§’åæ²¡æœ‰æ•°æ®åˆ°è¾¾ï¼Œä»»åŠ¡å°†ç¦»å¼€é˜»å¡çŠ¶æ€</p>
<p><strong>æ—¶é—´äº‹ä»¶</strong>ä¼šåœ¨æŒ‡å®šæ—¶é—´åˆ°è¾¾æˆ–è¿‡å»ä¸€å®šæ—¶é—´åå‘ç”Ÿ</p>
<p>å¯¹åº”<code>void vTaskDelay( TickType_t xTicksToDelay )</code>å’Œ</p>
<p><code>void vTaskDelayUntil( TickType_t * pxPreviousWakeTime, TickType_t xTimeIncrement )</code>å‡½æ•°</p>
<p>é€šè¿‡è¿™ä¸¤ä¸ªå‡½æ•°å³å¯è®¾å®šä¸€ä¸ªä»»åŠ¡æ‰§è¡Œçš„é¢‘ç‡</p>
<p>å…¶ä¸­<code>xTicksToDelay </code>å‚æ•°æŒ‡çš„æ˜¯æ‰€éœ€ç­‰å¾…çš„tickæ•°, é€šè¿‡<code>pdMS_TO_TICKS()</code>å‡½æ•°å°†æ¯«ç§’æ•°è½¬æ¢ä¸ºtickæ•°</p>
<p>tickæ•°å’Œmcuçš„é¢‘ç‡æŒ‚é’©, æ‰€ä»¥é€šè¿‡å‡½æ•°å°†æ¯«ç§’æ•°è¿›è¡Œè½¬æ¢å¯ä»¥é¿å…å› é¢‘ç‡æ›´æ”¹å¸¦æ¥çš„é”™è¯¯</p>
<p>é€šè¿‡å°†FreeRTOSConfig.h ä¸­çš„ <code>INCLUDE_vTaskSuspend</code> è®¾ç½®ä¸º 1, æ¥å¯ç”¨ <code>portMAX_DELAY </code></p>
<p>å°† <code>xTicksToWait</code> è®¾ç½®ä¸º <code>portMAX_DELAY </code>å°†å¯¼è‡´ä»»åŠ¡æ— é™æœŸç­‰å¾…ï¼ˆä¸ä¼šè¶…æ—¶ï¼‰</p>
<p><code>pxPreviousWakeTime</code>å‚æ•°æŒ‡çš„æ˜¯å½“å‰çš„tickæ•°, <code>xTimeIncrement </code>æŒ‡å®šå¤šå°‘tickäº§ç”Ÿä¸€æ¬¡äº‹ä»¶</p>
<p><code>pxPreviousWakeTime</code>ä»…éœ€æŒ‡å®šä¸€æ¬¡, ä¹‹åä¼šåœ¨å‡½æ•°å†…è‡ªå¢</p>
<p>ä¸¤ä¸ªå‡½æ•°ä¸åŒç‚¹åœ¨äº, å‰è€…æ˜¯ç›¸å¯¹çš„, è€Œåè€…æ˜¯ç»å¯¹çš„</p>
<p>ä½¿ç”¨ç¤ºä¾‹</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">vTaskFunction</span><span class="params">( <span class="type">void</span> * pvParameters )</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> * pcTaskName;</span><br><span class="line">    <span class="type">const</span> TickType_t xDelay250ms = pdMS_TO_TICKS( <span class="number">250</span> );</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * The string to print out is passed in via the parameter. Cast this to a</span></span><br><span class="line"><span class="comment">    * character pointer.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    pcTaskName = ( <span class="type">char</span> * ) pvParameters;</span><br><span class="line">    <span class="comment">/* As per most tasks, this task is implemented in an infinite loop. */</span></span><br><span class="line">    <span class="keyword">for</span>( ;; )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/* Print out the name of this task. */</span></span><br><span class="line">        vPrintLine( pcTaskName );</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        * Delay for a period. This time a call to vTaskDelay() is used which</span></span><br><span class="line"><span class="comment">        * places the task into the Blocked state until the delay period has</span></span><br><span class="line"><span class="comment">        * expired. The parameter takes a time specified in &#x27;ticks&#x27;, and the</span></span><br><span class="line"><span class="comment">        * pdMS_TO_TICKS() macro is used (where the xDelay250ms constant is</span></span><br><span class="line"><span class="comment">        * declared) to convert 250 milliseconds into an equivalent time in</span></span><br><span class="line"><span class="comment">        * ticks.</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        vTaskDelay( xDelay250ms );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">vTaskFunction</span><span class="params">( <span class="type">void</span> * pvParameters )</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> * pcTaskName;</span><br><span class="line">    TickType_t xLastWakeTime;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * The string to print out is passed in via the parameter. Cast this to a</span></span><br><span class="line"><span class="comment">    * character pointer.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    pcTaskName = ( <span class="type">char</span> * ) pvParameters;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * The xLastWakeTime variable needs to be initialized with the current tick</span></span><br><span class="line"><span class="comment">    * count. Note that this is the only time the variable is written to</span></span><br><span class="line"><span class="comment">    * explicitly. After this xLastWakeTime is automatically updated within</span></span><br><span class="line"><span class="comment">    * vTaskDelayUntil().</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    xLastWakeTime = xTaskGetTickCount();</span><br><span class="line">    <span class="comment">/* As per most tasks, this task is implemented in an infinite loop. */</span></span><br><span class="line">    <span class="keyword">for</span>( ;; )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/* Print out the name of this task. */</span></span><br><span class="line">        vPrintLine( pcTaskName );</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        * This task should execute every 250 milliseconds exactly. As per</span></span><br><span class="line"><span class="comment">        * the vTaskDelay() function, time is measured in ticks, and the</span></span><br><span class="line"><span class="comment">        * pdMS_TO_TICKS() macro is used to convert milliseconds into ticks.</span></span><br><span class="line"><span class="comment">        * xLastWakeTime is automatically updated within vTaskDelayUntil(), so</span></span><br><span class="line"><span class="comment">        * is not explicitly updated by the task.</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        vTaskDelayUntil( &amp;xLastWakeTime, pdMS_TO_TICKS( <span class="number">250</span> ) );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æŒ‚èµ·æ€</strong></p>
<p>å¤„äºæŒ‚èµ·çŠ¶æ€çš„ä»»åŠ¡ä¸å¯ç”¨äºè°ƒåº¦ç¨‹åºã€‚è¿›å…¥æŒ‚èµ·çŠ¶æ€çš„å”¯ä¸€æ–¹æ³•æ˜¯é€šè¿‡è°ƒç”¨ <code>vTaskSuspend() </code>API å‡½æ•°ï¼Œè€Œé€€å‡ºçŠ¶æ€çš„å”¯ä¸€æ–¹æ³•æ˜¯è°ƒç”¨ <code>vTaskResume() </code>æˆ– <code>xTaskResumeFromISR()</code> API å‡½æ•°ã€‚å¤§å¤šæ•°åº”ç”¨ç¨‹åºä¸ä½¿ç”¨æŒ‚èµ·çŠ¶æ€</p>
<p><img src="/../images/FreeRTOS/1.png" alt="1"></p>
<p>è‡³æ­¤, æ€»ç»“å‡ºå››ç§çŠ¶æ€çš„çŠ¶æ€è½¬æ¢å›¾</p>
<h3 id="åˆ é™¤-Delete-ä¸€ä¸ªä»»åŠ¡"><a href="#åˆ é™¤-Delete-ä¸€ä¸ªä»»åŠ¡" class="headerlink" title="åˆ é™¤(Delete)ä¸€ä¸ªä»»åŠ¡"></a>åˆ é™¤(Delete)ä¸€ä¸ªä»»åŠ¡</h3><p><code>vTaskDelete()</code> API å‡½æ•°åˆ é™¤ä»»åŠ¡ã€‚ä»…å½“ FreeRTOSConfig.h ä¸­çš„ <code>INCLUDE_vTaskDelete</code> è®¾ç½®ä¸º 1 æ—¶ï¼Œ<code>vTaskDelete()</code> API å‡½æ•°æ‰å¯ç”¨</p>
<p><code>void vTaskDelete( TaskHandle_t xTaskToDelete )</code>é€šè¿‡ä¼ é€’ä»»åŠ¡å¥æŸ„çš„æŒ‡é’ˆå®Œæˆåˆ é™¤</p>
<p>å½“ä»»åŠ¡è¢«åˆ é™¤æ—¶ï¼Œåªæœ‰å†…æ ¸æœ¬èº«åˆ†é…ç»™ä»»åŠ¡çš„å†…å­˜æ‰ä¼šè¢«è‡ªåŠ¨é‡Šæ”¾ã€‚å¦‚æœä¸å†éœ€è¦ï¼Œåœ¨ä»»åŠ¡æ‰§è¡ŒæœŸé—´åˆ†é…çš„ä»»ä½•å†…å­˜æˆ–å…¶ä»–èµ„æºéƒ½å¿…é¡»æ˜¾å¼é‡Šæ”¾</p>
<p>å½“ä»»åŠ¡è¢«åˆ é™¤æ—¶, å†…æ ¸æœ¬èº«åˆ†é…ç»™ä»»åŠ¡çš„èµ„æºç”±<strong>ç©ºé—²ä»»åŠ¡</strong>æ¥è¿›è¡Œé‡Šæ”¾</p>
<p>è¿™é‡Œæš‚ä¸”æŠŠç©ºé—²ä»»åŠ¡çœ‹ä½œä¸ºä¸€ä¸ª<strong>æœ€ä½ä¼˜å…ˆçº§çš„</strong>, <strong>åªåœ¨å°±ç»ªæ€åªå­˜åœ¨ç©ºé—²ä»»åŠ¡æ—¶æ‰æ‰§è¡Œ</strong>çš„ä¸€ä¸ªä»»åŠ¡</p>
<p>å› ä¸ºèµ„æºéœ€è¦é€šè¿‡ç©ºé—²ä»»åŠ¡æ¥è¿›è¡Œé‡Šæ”¾, æ‰€ä»¥éœ€è¦<strong>ä¿è¯ç©ºé—²ä»»åŠ¡ä¸è¢«é¥¿æ­»</strong>, ä¹‹åä¼šè¯´æ˜</p>
<h2 id="è°ƒåº¦ç®—æ³•"><a href="#è°ƒåº¦ç®—æ³•" class="headerlink" title="è°ƒåº¦ç®—æ³•"></a>è°ƒåº¦ç®—æ³•</h2><p>FreeRTOSé€šè¿‡è°ƒåº¦å™¨æ¥å†³å®šä»€ä¹ˆæ—¶å€™æ‰§è¡Œä»€ä¹ˆä»»åŠ¡</p>
<h3 id="ä¼˜å…ˆçº§"><a href="#ä¼˜å…ˆçº§" class="headerlink" title="ä¼˜å…ˆçº§"></a>ä¼˜å…ˆçº§</h3><p><strong>FreeRTOSä¿è¯æ€»æ˜¯é€‰æ‹©ä½äºå°±ç»ªæ€çš„æœ€é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡è¿›å…¥è¿è¡Œæ€</strong></p>
<p>é‚£ä¹ˆ<strong>ç›¸åŒä¼˜å…ˆçº§çš„ä»»åŠ¡</strong>å‘¢?</p>
<p>FreeRTOSé‡‡ç”¨<strong>å¾ªç¯è°ƒåº¦</strong>çš„ç®—æ³•, å³åƒä¸€ä¸ªé˜Ÿåˆ—ä¸€æ ·, è¿è¡Œå®Œæ¯•çš„ä»»åŠ¡å›åˆ°é˜Ÿåˆ—æœ«å°¾, ä½äºé˜Ÿåˆ—é¦–çš„ä»»åŠ¡è¢«é€‰ä¸­è¿›å…¥è¿è¡Œæ€</p>
<p>ä¼˜å…ˆçº§çš„æœ€å¤§å€¼ç”±<code>configMAX_PRIORITIES</code>å†³å®š</p>
<p>ä¼˜å…ˆçº§çš„èŒƒå›´ä»0åˆ°<code>configMAX_PRIORITIES - 1</code>, 0å³æœ€ä½ä¼˜å…ˆçº§</p>
<p>å¯¹äºä¼˜å…ˆçº§, æœ‰ä¸¤ç§è°ƒåº¦ç¨‹åºå¯é€‰, åˆ†åˆ«æ˜¯<strong>é€šç”¨è°ƒåº¦(Generic Scheduler)<strong>å’Œ</strong>æ¶æ„ä¼˜åŒ–è°ƒåº¦(Architecture-Optimized Scheduler)</strong></p>
<p><strong>é€šç”¨è°ƒåº¦</strong>æ²¡æœ‰å¯¹<code>configMAX_PRIORITIES</code>æ–½åŠ ä¸Šé™, ä½†ç”±äºæ›´å¤§çš„å€¼æ„å‘³ç€éœ€è¦æ›´å¤šçš„RAMä»¥åŠæ›´é•¿çš„æœ€åæƒ…å†µæ‰§è¡Œæ—¶é—´, æ‰€ä»¥ä¸€èˆ¬æ¥è¯´, å»ºè®®æœ€å°åŒ–<code>configMAX_PRIORITIES</code></p>
<p><strong>æ¶æ„ä¼˜åŒ–è°ƒåº¦</strong>å¯ä»¥æ ¹æ®ä¸åŒçš„æ¶æ„ä¼˜åŒ–<code>configMAX_PRIORITIES</code>çš„å€¼, ä¾‹å¦‚åœ¨32ä½æ¶æ„ä¸Šè¯¥å€¼ä¸º32, 64ä½æ¶æ„ä¸Šè¯¥å€¼ä¸º64</p>
<p>è¦ä½¿ç”¨æ¶æ„ä¼˜åŒ–è°ƒåº¦, åªéœ€è¦åœ¨FreeRTOSConfig.h ä¸­å°† <code>configUSE_PORT_optimized_TASK_SELECTION</code> è®¾ç½®ä¸º 1, ä¸º0åˆ™ä¸ºé€šç”¨è°ƒåº¦</p>
<p>ä½†ä¸æ˜¯æ‰€æœ‰FreeRTOSç«¯å£éƒ½æœ‰æ¶æ„ä¼˜åŒ–çš„å®ç°, å¯ä»¥æ ¹æ®<code>configUSE_PORT_optimized_TASK_SELECTION</code>çš„é»˜è®¤å€¼æ¥åˆ¤æ–­, å¦‚æœä¸º1, åˆ™è¯´æ˜æœ‰, åä¹‹åˆ™æ— </p>
<p><strong>ä¼˜å…ˆçº§ä¸åªèƒ½åœ¨ä»»åŠ¡åˆ›å»ºæ—¶æŒ‡å®š, è¿˜å¯ä»¥åœ¨ç¨‹åºä¸­åŠ¨æ€è¿›è¡Œä¿®æ”¹</strong></p>
<p>å½“ FreeRTOSConfig.h ä¸­çš„ <code>INCLUDE_vTaskPrioritySet</code> è®¾ç½®ä¸º 1 æ—¶</p>
<p>å¯ä»¥ä½¿ç”¨<code>vTaskPrioritySet()</code>åœ¨ç¨‹åºä¸­åŠ¨æ€ä¿®æ”¹ä»»åŠ¡çš„ä¼˜å…ˆçº§</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">vTaskPrioritySet</span><span class="params">( TaskHandle_t xTask,</span></span><br><span class="line"><span class="params">UBaseType_t uxNewPriority )</span>;</span><br></pre></td></tr></table></figure>

<p>å½“ FreeRTOSConfig.h ä¸­çš„ <code>INCLUDE_uxTaskPriorityGet</code> è®¾ç½®ä¸º 1 æ—¶</p>
<p>è¿˜å¯ä»¥ä½¿ç”¨<code>uxTaskPriorityGet()</code>åŠ¨æ€è·å–ä»»åŠ¡çš„ä¼˜å…ˆçº§</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UBaseType_t <span class="title function_">uxTaskPriorityGet</span><span class="params">( TaskHandle_t xTask )</span>;</span><br></pre></td></tr></table></figure>

<h3 id="ç©ºé—²ä»»åŠ¡"><a href="#ç©ºé—²ä»»åŠ¡" class="headerlink" title="ç©ºé—²ä»»åŠ¡"></a>ç©ºé—²ä»»åŠ¡</h3><p>ç©ºé—²ä»»åŠ¡, é¡¾åæ€ä¹‰, å°±æ˜¯åœ¨æ²¡æœ‰ä»»åŠ¡å¯ä»¥æ‰§è¡Œæ—¶ æ‰§è¡Œçš„ä»»åŠ¡</p>
<p>å…¶ä½œç”¨ä¸»è¦æ˜¯èµ·å ä½ç¬¦ä½œç”¨, å› ä¸ºFreeRTOSéœ€è¦ä¿è¯åœ¨ä»»ä½•æ—¶åˆ»éƒ½æœ‰ä»»åŠ¡å¯ä»¥è¿›å…¥è¿è¡Œæ€</p>
<p>ä»–çš„<strong>ä¼˜å…ˆçº§ä¸ºæœ€ä½çš„0</strong>, ä¿è¯äº†ä¸ä¼šå› ä¼˜å…ˆçº§æ›´å¤§è€Œé˜»ç¢åˆ«çš„ä»»åŠ¡</p>
<p>ç©ºé—²ä»»åŠ¡è¿˜æœ‰ä¸€ä¸ªä½œç”¨å°±æ˜¯<strong>æ¸…é™¤ç”±<code>vTaskDelete() </code>å‡½æ•°æ®‹ç•™çš„å†…æ ¸èµ„æº</strong></p>
<p>è™½ç„¶ç©ºé—²ä»»åŠ¡çš„ä¼˜å…ˆçº§ä¸ºæœ€ä½çš„0, ä½†ä¹Ÿå¯èƒ½å­˜åœ¨ç›¸åŒçš„, ä¼˜å…ˆçº§ä¸º0çš„ä»»åŠ¡, è¿™æ—¶, æˆ‘ä»¬è‚¯å®šä¸æƒ³ç©ºé—²ä»»åŠ¡å’Œæˆ‘ä»¬çš„ä»»åŠ¡æŠ¢å¤ºè¿è¡Œæ—¶é—´</p>
<p>FreeRTOSConfig.h ä¸­çš„ <code>configIDLE_SHOULD_YIELD</code>å†³å®šç©ºé—²ä»»åŠ¡æ˜¯å¦ä¼šå’Œå…¶ä»–0ä¼˜å…ˆçº§ä»»åŠ¡æŠ¢å¤ºè¿è¡Œæ—¶é—´</p>
<p>å½“<code>configIDLE_SHOULD_YIELD</code>ç½®0æ—¶, ç©ºé—²ä»»åŠ¡å’Œå…¶ä»–ä»»åŠ¡ä¸€æ ·, éµå¾ª<strong>å¾ªç¯è°ƒåº¦</strong>çš„ç®—æ³•</p>
<p>å½“<code>configIDLE_SHOULD_YIELD</code>ç½®1æ—¶, å½“æœ‰å…¶ä»–0ä¼˜å…ˆçº§ä»»åŠ¡å¤„äºå°±ç»ªæ€æ—¶, ç©ºé—²ä»»åŠ¡å°†åœ¨æ¯æ¬¡è¿­ä»£ä¸­è®©æ­¥, å°†è¿è¡Œæ—¶é—´è®©ç»™å…¶ä»–ä»»åŠ¡</p>
<p><img src="/../images/FreeRTOS/2.png" alt="2"></p>
<p>åœ¨æ¯æ¬¡è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶(è¿™é‡Œæ¯ä¸ªé—´éš”ç§°ä¸ºä¸€ä¸ªæ—¶é—´ç‰‡, æ¯ä¸ªäº‹ä»¶ç‰‡çš„æœ«å°¾æ‰§è¡Œä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢), å…ˆæ˜¯ç”±å¾ªç¯è°ƒåº¦è¿è¡Œç©ºé—²ä»»åŠ¡, æ­¤æ—¶ç©ºé—²ä»»åŠ¡å‘ç°å°±ç»ªæ€è¿˜æœ‰å…¶ä»–0ä¼˜å…ˆçº§çš„ä»»åŠ¡, äºæ˜¯ä¸»åŠ¨è®©å‡ºè¯¥æ—¶é—´ç‰‡çš„å‰©ä½™æ—¶é—´.</p>
<p>t6åˆ°t7æ—¶é—´æ®µè¿˜æ­ç¤ºäº†é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡æ˜¯å¦‚ä½•æŠ¢å ä½ä¼˜å…ˆçº§çš„ä»»åŠ¡çš„(è¯¦è§åæ–‡)</p>
<p>ç©ºé—²ä»»åŠ¡æ˜¯å¯ä»¥é€šè¿‡é’©å­å‡½æ•°è¿›è¡Œhookçš„</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">vApplicationIdleHook</span><span class="params">( <span class="type">void</span> )</span>;</span><br></pre></td></tr></table></figure>

<p>ç©ºé—²ä»»åŠ¡æŒ‚é’©çš„å¸¸è§ç”¨é€”åŒ…æ‹¬ï¼š </p>
<p><strong>æ‰§è¡Œä½ä¼˜å…ˆçº§ã€åå°æˆ–è¿ç»­å¤„ç†åŠŸèƒ½ï¼Œè€Œæ— éœ€ä¸ºæ­¤ç›®çš„åˆ›å»ºåº”ç”¨ç¨‹åºä»»åŠ¡è€Œäº§ç”Ÿ RAM å¼€é”€ã€‚</strong></p>
<p><strong>æµ‹é‡ç©ºé—²å¤„ç†èƒ½åŠ›çš„é‡ã€‚</strong> ï¼ˆåªæœ‰å½“æ‰€æœ‰è¾ƒé«˜ä¼˜å…ˆçº§çš„åº”ç”¨ç¨‹åºä»»åŠ¡éƒ½æ²¡æœ‰è¦æ‰§è¡Œçš„å·¥ä½œæ—¶ï¼Œç©ºé—²ä»»åŠ¡æ‰ä¼šè¿è¡Œï¼›å› æ­¤ï¼Œæµ‹é‡åˆ†é…ç»™ç©ºé—²ä»»åŠ¡çš„å¤„ç†æ—¶é—´é‡å¯ä»¥æ¸…æ¥šåœ°æŒ‡ç¤ºç©ºé—²å¤„ç†æ—¶é—´ã€‚ï¼‰</p>
<p><strong>å°†å¤„ç†å™¨ç½®äºä½åŠŸè€—æ¨¡å¼</strong>ï¼Œåœ¨æ²¡æœ‰è¦æ‰§è¡Œçš„åº”ç”¨ç¨‹åºå¤„ç†æ—¶æä¾›ä¸€ç§ç®€å•ä¸”è‡ªåŠ¨çš„èŠ‚èƒ½æ–¹æ³•ï¼ˆå°½ç®¡å¯å®ç°çš„èŠ‚èƒ½æ•ˆæœä½äºæ— æ»´ç­”ç©ºé—²æ¨¡å¼æ‰€å®ç°çš„èŠ‚èƒ½æ•ˆæœï¼‰ã€‚</p>
<p>ç©ºé—²ä»»åŠ¡æŒ‚é’©å‡½æ•°å¿…é¡»éµå®ˆä»¥ä¸‹è§„åˆ™:</p>
<p><strong>ç©ºé—²ä»»åŠ¡æŒ‚é’©å‡½æ•°ç»ä¸èƒ½å°è¯•é˜»æ­¢æˆ–æŒ‚èµ·è‡ªèº«ã€‚</strong></p>
<p>æ³¨æ„ï¼š**ä»¥ä»»ä½•æ–¹å¼é˜»æ­¢ç©ºé—²ä»»åŠ¡éƒ½å¯èƒ½å¯¼è‡´æ²¡æœ‰ä»»åŠ¡å¯è¿›å…¥è¿è¡ŒçŠ¶æ€çš„æƒ…å†µã€‚**å¦‚æœåº”ç”¨ç¨‹åºä»»åŠ¡ä½¿ç”¨ vTaskDelete() API å‡½æ•°åˆ é™¤è‡ªèº«ï¼Œåˆ™ç©ºé—²ä»»åŠ¡æŒ‚é’©å¿…é¡»å§‹ç»ˆåœ¨åˆç†çš„æ—¶é—´æ®µå†…è¿”å›åˆ°å…¶è°ƒç”¨è€…ã€‚è¿™æ˜¯å› ä¸ºç©ºé—²ä»»åŠ¡è´Ÿè´£æ¸…ç†åˆ†é…ç»™åˆ é™¤è‡ªèº«çš„ä»»åŠ¡çš„å†…æ ¸èµ„æºã€‚å¦‚æœç©ºé—²ä»»åŠ¡æ°¸ä¹…ä¿ç•™åœ¨ç©ºé—²æŒ‚é’©å‡½æ•°ä¸­ï¼Œåˆ™æ— æ³•è¿›è¡Œæ­¤æ¸…ç†</p>
<h3 id="æ—¶é—´ç‰‡-æŠ¢å å¼ä¸åä½œå¼"><a href="#æ—¶é—´ç‰‡-æŠ¢å å¼ä¸åä½œå¼" class="headerlink" title="æ—¶é—´ç‰‡, æŠ¢å å¼ä¸åä½œå¼"></a>æ—¶é—´ç‰‡, æŠ¢å å¼ä¸åä½œå¼</h3><h4 id="æ—¶é—´ç‰‡"><a href="#æ—¶é—´ç‰‡" class="headerlink" title="æ—¶é—´ç‰‡"></a>æ—¶é—´ç‰‡</h4><p>è¯•æƒ³å½“æœ‰ä¸¤ä¸ªä¼˜å…ˆçº§ç›¸åŒçš„, è¿ç»­è¿è¡Œ(ä¸ä¼šè¿›å…¥é˜»å¡æ€)çš„ä»»åŠ¡, å¦‚æœæ­£åœ¨è¿è¡Œä¸­çš„é‚£ä¸€ä¸ªä»»åŠ¡ä¸€ç›´ä¸ä¸»åŠ¨é€€å‡ºçš„è¯, é‚£å¦ä¸€ä¸ªä»»åŠ¡å°†ä¼šè¢«é¥¿æ­»</p>
<p>å¦‚ä½•ä½¿ä¸¤ä¸ªåŒçº§çš„ä»»åŠ¡â€åŒæ—¶â€æ‰§è¡Œå‘¢?</p>
<p>äºæ˜¯æœ‰äº†<strong>æ—¶é—´ç‰‡(time slice)</strong></p>
<p>æ—¶é—´ç‰‡æ˜¯ä¸€æ®µæ—¶é—´, åœ¨ä¸€æ®µæ—¶é—´å, å³æ—¶é—´ç‰‡çš„æœ«å°¾, è°ƒç”¨ä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢, é€šè¿‡å¾ªç¯è°ƒåº¦, ä½¿å°±ç»ªæ€ä¸­çš„ä»»åŠ¡è¿›å…¥è¿è¡Œæ€</p>
<p>æ—¶é—´ç‰‡çš„é•¿åº¦ç”±<code>configTICK_RATE_HZ</code>å†³å®š, <code>configTICK_RATE_HZ</code>è¢«è®¾ç½®ä¸º100Hzæ—¶, æŒ‡ä¸€ä¸ªæ—¶é—´ç‰‡ä¸º1 &#x2F; 100(s), å³10ms</p>
<p><code>configTICK_RATE_HZ</code> çš„æœ€ä½³å€¼å–å†³äºåº”ç”¨ç¨‹åºï¼Œä½†å…¸å‹å€¼ä¸º 100</p>
<p><img src="/../images/FreeRTOS/3.png" alt="3"></p>
<h4 id="æŠ¢å å¼è°ƒåº¦"><a href="#æŠ¢å å¼è°ƒåº¦" class="headerlink" title="æŠ¢å å¼è°ƒåº¦"></a>æŠ¢å å¼è°ƒåº¦</h4><p>æŠ¢å å¼å³é«˜ä¼˜å…ˆçº§ä¼šç›´æ¥æ‰“æ–­ä½ä¼˜å…ˆçº§ä»»åŠ¡çš„æ‰§è¡Œ, ä¸Šæ–‡é»˜è®¤æ˜¯ä½¿ç”¨çš„æŠ¢å å¼ç®—æ³•</p>
<p>é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡é€šå¸¸æ ‡å¿—ç€ ç´§æ€¥, é‡è¦</p>
<p>å› æ­¤éœ€è¦ä¿è¯é«˜ä¼˜å…ˆçº§ä»»åŠ¡ä» è¿›å…¥å°±ç»ªæ€ åˆ° ä»å°±ç»ªæ€è¿›å…¥è¿è¡Œæ€ çš„æ—¶é—´</p>
<p>ä»»åŠ¡çš„æŠ¢å æ˜¯å¯ä»¥åµŒå¥—çš„, è¿™æ„å‘³ç€åœ¨ä½ä¼˜å…ˆçº§ä»»åŠ¡è¢«é«˜ä¼˜å…ˆçº§ä»»åŠ¡æŠ¢å æ—¶å€™, é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡æ˜¯å¯ä»¥è¢«æ›´é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡æ‰€æŠ¢å </p>
<p>å³ä½¿é‡åˆ°æ—¶é—´ç‰‡ç»“æŸæ—¶çš„<strong>ä¸Šä¸‹æ–‡åˆ‡æ¢</strong>, ä¸‹ä¸€ä¸ªæ—¶é—´ç‰‡ä»ç„¶ä¼šæ‰§è¡Œæ›´é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡, å› ä¸ºæ­¤æ—¶å°±ç»ªæ€ä¸­æœ€é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ä»ç„¶æ˜¯ä»–è‡ªå·±</p>
<h4 id="ä¸‰ç§è°ƒåº¦ç®—æ³•"><a href="#ä¸‰ç§è°ƒåº¦ç®—æ³•" class="headerlink" title="ä¸‰ç§è°ƒåº¦ç®—æ³•"></a>ä¸‰ç§è°ƒåº¦ç®—æ³•</h4><p>æ˜¯å¦ä½¿ç”¨æ—¶é—´ç‰‡ä»¥åŠæ˜¯å¦ä½¿ç”¨æŠ¢å å¼è°ƒåº¦å¯ä»¥é€šè¿‡FreeRTOSConfig.hä¸­<code>configUSE_PREEMPTION</code> å’Œ <code>configUSE_TIME_SLICING</code>çš„å€¼è¿›è¡Œé…ç½®</p>
<p>ç¬¬ä¸‰ä¸ªé…ç½®å¸¸é‡ <code>configUSE_TICKLESS_IDLE</code> ä¹Ÿä¼šå½±å“è°ƒåº¦ç®—æ³•, ä»–å†³å®šäº†æ—¶é—´ç‰‡æœ«å°¾çš„ä¸Šä¸‹æ–‡åˆ‡æ¢è¯·æ±‚åœ¨ç©ºé—²æ—¶æ˜¯å¦ä¼šå…³é—­ ä»¥æœ€å¤§é™åº¦åœ°é™ä½åŠŸè€—, é»˜è®¤ä¸º0(å…³é—­)</p>
<p><code>configUSE_PREEMPTION</code> å’Œ <code>configUSE_TIME_SLICING</code>çš„ä¸åŒé…ç½®å†³å®šäº†ç¨‹åºä½¿ç”¨å“ªä¸€ç§è°ƒåº¦ç®—æ³•</p>
<p><img src="/../images/FreeRTOS/4.png" alt="4"></p>
<p><strong>å¸¦æœ‰æ—¶é—´åˆ‡ç‰‡çš„å›ºå®šä¼˜å…ˆçº§æŠ¢å å¼è°ƒåº¦(Prioritized Preemptive Scheduling with Time Slicing)</strong></p>
<p><img src="/../images/FreeRTOS/5.png" alt="5"></p>
<p>è¿™ä¹Ÿæ˜¯æœ€ä¸ºå¸¸è§çš„ä¸€ç§ç®—æ³•</p>
<p><strong>æ— æ—¶é—´åˆ†ç‰‡çš„ä¼˜å…ˆæŠ¢å å¼è°ƒåº¦(Prioritized Preemptive Scheduling without Time Slicing)</strong></p>
<p><img src="/../images/FreeRTOS/6.png" alt="6"></p>
<p>ç”±äºæ²¡æœ‰æ—¶é—´ç‰‡æä¾›çš„å®šæœŸçš„ä¸Šä¸‹æ–‡åˆ‡æ¢, å¯¼è‡´ç©ºé—²ä»»åŠ¡ä¸€ç›´å ç€cpuå¯¼è‡´ä»»åŠ¡2æ‰§è¡Œæ—¶é—´è¿œå°äºç©ºé—²ä»»åŠ¡(<code>configIDLE_SHOULD_YIELD</code>ä¸º0çš„æƒ…å†µ)</p>
<p><strong>ååŒè°ƒåº¦(Cooperative Scheduling)</strong></p>
<p><img src="/../images/FreeRTOS/7.png" alt="7"></p>
<p>ååŒè°ƒåº¦ç®—æ³•ä¸‹çš„ä»»åŠ¡åªæœ‰åœ¨ä¸€ä¸ªä»»åŠ¡è¿è¡Œç»“æŸæ—¶æ‰ä¼šè¿›è¡Œåˆ‡æ¢</p>
<p>å¯ç”¨äºæ•°æ®ä¼ è¾“çš„æƒ…å†µ</p>
<p>ä¾‹å¦‚ä»»åŠ¡1å°†è¦å‘é€â€™abcdefgâ€™</p>
<p>ä»»åŠ¡2å°†è¦å‘é€â€™1234567890â€™</p>
<p>æˆ‘ä»¬è‚¯å®šä¸æƒ³åœ¨ä»»åŠ¡2å‘é€æœŸé—´è¢«ä»»åŠ¡1æŠ¢å ä½¿å¾—å‘é€å‡ºçš„æ•°æ®è¢«ç ´å</p>
<p>ä½†è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥‡æ€ªçš„ä¾‹å­, ä½¿ç”¨æ— æ—¶é—´åˆ†ç‰‡çš„ä¼˜å…ˆæŠ¢å å¼è°ƒåº¦, ç„¶åå°†ä¸¤è€…çš„ä»»åŠ¡ä¼˜å…ˆçº§ç½®ä¸ºç›¸åŒ ä¹Ÿå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜, ä½†è¿™æ ·å¿…é¡»é™åˆ¶å‘é€æ•°æ®çš„ä»»åŠ¡ä¸ºç›¸åŒä¼˜å…ˆçº§</p>
<p>è€Œä¸”è¿›ç¨‹é—´é€šä¿¡å¾€å¾€æœ‰æ›´å¥½çš„æ–¹æ³•</p>
<h2 id="TLSä¸å¯é‡å…¥"><a href="#TLSä¸å¯é‡å…¥" class="headerlink" title="TLSä¸å¯é‡å…¥"></a>TLSä¸å¯é‡å…¥</h2><p><em>æŠ„å½•</em></p>
<p>çº¿ç¨‹æœ¬åœ°å­˜å‚¨(TLS)å…è®¸åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜åœ¨æ¯ä¸ªä»»åŠ¡çš„ä»»åŠ¡æ§åˆ¶å—ä¸­å­˜å‚¨ä»»æ„æ•°æ®ã€‚æ­¤åŠŸèƒ½æœ€å¸¸ç”¨äºå­˜å‚¨é€šå¸¸ç”±ä¸å¯é‡å…¥å‡½æ•°å­˜å‚¨åœ¨å…¨å±€å˜é‡ä¸­çš„æ•°æ®ã€‚å¯é‡å…¥å‡½æ•°æ˜¯å¯ä»¥ä»å¤šä¸ªçº¿ç¨‹å®‰å…¨è¿è¡Œè€Œæ²¡æœ‰ä»»ä½•å‰¯ä½œç”¨çš„å‡½æ•°ã€‚å½“åœ¨æ²¡æœ‰çº¿ç¨‹æœ¬åœ°å­˜å‚¨çš„å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä½¿ç”¨ä¸å¯é‡å…¥å‡½æ•°æ—¶ï¼Œå¿…é¡»ç‰¹åˆ«æ³¨æ„æ£€æŸ¥ä¸´ç•ŒåŒºå†…è¿™äº›å‡½æ•°è°ƒç”¨çš„å¸¦å¤–ç»“æœã€‚è¿‡åº¦ä½¿ç”¨ä¸´ç•ŒåŒºä¼šé™ä½ RTOS æ€§èƒ½ï¼Œå› æ­¤çº¿ç¨‹æœ¬åœ°å­˜å‚¨é€šå¸¸ä¼˜äºä½¿ç”¨ä¸´ç•ŒåŒºã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œçº¿ç¨‹æœ¬åœ°å­˜å‚¨æœ€å¸¸è§çš„ç”¨é€”æ˜¯ C æ ‡å‡†åº“å’Œ POSIX ç³»ç»Ÿä½¿ç”¨çš„ ISO C æ ‡å‡†ä¸­ä½¿ç”¨çš„ errno å…¨å±€å˜é‡ã€‚ errno å…¨å±€ç”¨äºä¸ºå¸¸è§æ ‡å‡†åº“å‡½æ•°ï¼ˆä¾‹å¦‚ strtof å’Œ strtolï¼‰æä¾›æ‰©å±•ç»“æœæˆ–é”™è¯¯ä»£ç </p>
<p>å¤§å¤šæ•°åµŒå…¥å¼ libc å®ç°éƒ½æä¾› API ä»¥ç¡®ä¿ä¸å¯é‡å…¥å‡½æ•°å¯ä»¥åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­æ­£å¸¸å·¥ä½œã€‚ FreeRTOS æ”¯æŒä¸¤ä¸ªå¸¸ç”¨å¼€æºåº“çš„é‡å…¥ APIï¼šnewlib å’Œ picolibcã€‚è¿™äº›é¢„æ„å»ºçš„ C è¿è¡Œæ—¶çº¿ç¨‹æœ¬åœ°å­˜å‚¨å®ç°å¯ä»¥é€šè¿‡åœ¨å…¶é¡¹ç›®çš„ FreeRTOSConfig.h æ–‡ä»¶ä¸­å®šä¹‰ä¸‹é¢åˆ—å‡ºçš„ç›¸åº”å®æ¥å¯ç”¨</p>
<p>åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜å¯ä»¥é€šè¿‡åœ¨ FreeRTOSConfig.h æ–‡ä»¶ä¸­å®šä¹‰ä»¥ä¸‹å®æ¥å®ç°çº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼š å°† configUSE_C_RUNTIME_TLS_SUPPORT å®šä¹‰ä¸º 1 ä»¥å¯ç”¨ C è¿è¡Œæ—¶çº¿ç¨‹æœ¬åœ°å­˜å‚¨æ”¯æŒã€‚å°† configTLS_BLOCK_TYPE å®šä¹‰ä¸º c ç±»å‹ï¼Œè¯¥ç±»å‹åº”ç”¨äºå­˜å‚¨ C è¿è¡Œæ—¶çº¿ç¨‹æœ¬åœ°å­˜å‚¨æ•°æ®ã€‚å°† configINIT_TLS_BLOCK å®šä¹‰ä¸ºåˆå§‹åŒ– C è¿è¡Œæ—¶çº¿ç¨‹æœ¬åœ°å­˜å‚¨å—æ—¶åº”è¿è¡Œçš„ C ä»£ç ã€‚å°† configSET_TLS_BLOCK å®šä¹‰ä¸ºåˆ‡æ¢æ–°ä»»åŠ¡æ—¶åº”è¿è¡Œçš„ c ä»£ç  å°† configDEINIT_TLS_BLOCK å®šä¹‰ä¸ºåœ¨å–æ¶ˆåˆå§‹åŒ– C è¿è¡Œæ—¶çº¿ç¨‹æœ¬åœ°å­˜å‚¨å—æ—¶åº”è¿è¡Œçš„ c ä»£ç </p>
<h2 id="ä¸Šä¸‹æ–‡åˆ‡æ¢åŸç†"><a href="#ä¸Šä¸‹æ–‡åˆ‡æ¢åŸç†" class="headerlink" title="ä¸Šä¸‹æ–‡åˆ‡æ¢åŸç†"></a>ä¸Šä¸‹æ–‡åˆ‡æ¢åŸç†</h2><p>å½“åœ¨ä»»åŠ¡ä¸­æ‰‹åŠ¨è°ƒç”¨<code>vTaskStartScheduler()</code>ç¬¬ä¸€æ¬¡å¯åŠ¨è°ƒåº¦å™¨æ—¶ä¼šè§¦å‘<strong>SVCå¼‚å¸¸</strong></p>
<p>OSæ”¶åˆ°è¯·æ±‚ååœ¨SVC Handlerä¸­åšå¥½ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å‡†å¤‡, åŒæ—¶æ‚¬èµ·ä¸€ä¸ªpendSVå¼‚å¸¸</p>
<p>å½“CPUé€€å‡ºSVCä¸”è¢«åµŒå¥—çš„ä¸­æ–­ä¾‹ç¨‹æ‰§è¡Œç»“æŸå, è¿›å…¥pendSV, è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢</p>
<p>åœ¨ä»»åŠ¡ä¸­æ‰‹åŠ¨è°ƒç”¨<code>taskYIELD()</code>æ—¶ä¼šç›´æ¥æ‚¬èµ·ä¸€ä¸ªpendSVå¼‚å¸¸</p>
<p>ä¸€ä¸ªæ—¶é—´ç‰‡æœ«å°¾äº§ç”Ÿçš„Systickä¸­æ–­ç°è±¡ä¸æ‰‹åŠ¨è°ƒç”¨<code>taskYIELD()</code>ç›¸åŒ</p>
<h2 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h2><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/115382535">FreeRTOS ä»å…¥é—¨åˆ°ç²¾é€š5â€“ä»»åŠ¡ç®¡ç†è¿™ä»¶äº‹ï¼ˆä¸Šï¼‰</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/127953272">FreeRTOS ä»å…¥é—¨åˆ°ç²¾é€š6â€“ä»»åŠ¡ç®¡ç†è¿™ä»¶äº‹ï¼ˆä¸‹ï¼‰ï¼ˆå¯¹æ¯”PLCï¼Œå®‰å“ï¼‰</a></p>
<p><strong>Mastering-the-FreeRTOS-Real-Time-Kernel.v1.1.0 (Richard Barry -and- The FreeRTOS Team)</strong></p>
<p><strong>Cortex-M3æƒå¨æŒ‡å—(Joseph Yiu è‘— å®‹å²© è¯‘ <a target="_blank" rel="noopener" href="http://www.ouravr.comçƒ­å¿ƒç½‘å‹/">www.ouravr.comçƒ­å¿ƒç½‘å‹</a> æ ¡å¯¹)</strong></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/11/28/HAL%E5%BA%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="Sn0r1ax">
      <meta itemprop="description" content="ğŸ˜˜ğŸ˜˜ğŸ˜˜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sn0r1ax">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/11/28/HAL%E5%BA%93/" class="post-title-link" itemprop="url">HALåº“å­¦ä¹ éšç¬”</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-11-28 20:58:41" itemprop="dateCreated datePublished" datetime="2025-11-28T20:58:41+08:00">2025-11-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-12-01 15:09:16" itemprop="dateModified" datetime="2025-12-01T15:09:16+08:00">2025-12-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">åµŒå…¥å¼</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          Here's something encrypted, password is required to continue reading.
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2025/11/28/HAL%E5%BA%93/#more" rel="contents">
                é˜…è¯»å…¨æ–‡ &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/11/27/CAN%E6%80%BB%E7%BA%BF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="Sn0r1ax">
      <meta itemprop="description" content="ğŸ˜˜ğŸ˜˜ğŸ˜˜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sn0r1ax">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/11/27/CAN%E6%80%BB%E7%BA%BF/" class="post-title-link" itemprop="url">CANæ€»çº¿å­¦ä¹ ç¬”è®°</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-11-27 22:44:33" itemprop="dateCreated datePublished" datetime="2025-11-27T22:44:33+08:00">2025-11-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-12-21 15:03:25" itemprop="dateModified" datetime="2025-12-21T15:03:25+08:00">2025-12-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">åµŒå…¥å¼</span></a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CAN/" itemprop="url" rel="index"><span itemprop="name">CAN</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="åè®®è§„å®š"><a href="#åè®®è§„å®š" class="headerlink" title="åè®®è§„å®š"></a>åè®®è§„å®š</h2><p>å·®åˆ†ä¿¡å·</p>
<p>å·®å€¼ä¸º0ä¸ºé€»è¾‘1(éšæ€§ç”µå¹³)</p>
<p>å·®å€¼ä¸ä¸º0ä¸ºé€»è¾‘1(æ˜¾æ€§ç”µå¹³) (å…·ä½“å·®å€¼èŒƒå›´å¤šå°‘å’Œé«˜é€Ÿ\ä½é€ŸCANåè®®æœ‰å…³)</p>
<p>å¯è®°ä¸ºç”µå¹³æ‹‰å¼€ä¸º0, é—­åˆä¸º1</p>
<p>å¼‚æ­¥åŠåŒå·¥</p>
<h2 id="å¸§æ ¼å¼"><a href="#å¸§æ ¼å¼" class="headerlink" title="å¸§æ ¼å¼"></a>å¸§æ ¼å¼</h2><p>æ•°æ®å¸§ é¥æ§å¸§ é”™è¯¯å¸§ è¿‡è½½å¸§ å¸§é—´éš”</p>
<p>EOFä¹‹åä»éœ€3ä½æ˜¾æ€§ç”µå¹³çš„å¸§é—´éš”æ‰èƒ½è¿›å…¥ä¸‹ä¸€ä¸ªé€šä¿¡</p>
<p><strong>ä½å¡«å……æœºåˆ¶</strong>:å…¼å®¹é”™è¯¯å¸§å’Œè¿‡è½½å¸§ é¿å…é”™ä½å’Œé˜²æ­¢è¢«è¯¯è®¤ä¸ºæ˜¯ç©ºé—²</p>
<h2 id="ä½åŒæ­¥"><a href="#ä½åŒæ­¥" class="headerlink" title="ä½åŒæ­¥"></a>ä½åŒæ­¥</h2><p>é€šè¿‡å¼•å…¥ä½æ—¶åº</p>
<p>è§£å†³æ—¶åºèµ·å§‹ä½ä¸åŒæ­¥-&gt;ç¡¬åŒæ­¥</p>
<p>è§£å†³æ—¶åºä¼ è¾“è¿‡ç¨‹ä¸­çš„åå·®-&gt;å†åŒæ­¥</p>
<p>canæ€»çº¿ä¸­ç å…ƒæŒ‡çš„æ˜¯ä¸€ä¸ªä½æ—¶åº, æ³¢ç‰¹ç‡ä¹Ÿå› æ­¤ç”±ä¸€ä¸ªä½æ—¶åºæ‰€éœ€æ—¶é—´å†³å®š</p>
<h2 id="ä»²è£"><a href="#ä»²è£" class="headerlink" title="ä»²è£"></a>ä»²è£</h2><p>è¿ç»­11ä¸ªéšå½¢ç”µå¹³-&gt;ç©ºé—²çŠ¶æ€</p>
<p>ä¸¤ç§ä»²è£æœºåˆ¶æŠ¤èˆª:</p>
<ol>
<li>å…ˆåˆ°å…ˆå¾— åªæœ‰å½“æ£€æµ‹åˆ°ç©ºé—²çŠ¶æ€çš„æƒ…å†µä¸‹æ‰å°è¯•å‘é€æ•°æ®</li>
<li>é€šè¿‡ä»²è£æ®µè¿›è¡Œä»²è£</li>
</ol>
<p>ID + RTR ä½œä¸ºä»²è£æ®µ</p>
<p>çº¿ä¸ç‰¹æ€§: canæ€»çº¿æ‹‰å¼€ä»£è¡¨æ˜¾æ€§0, å½“å¤šä¸ªä¸»æœºä¸­ä»»ä¸€ä¸»æœºæ‹‰å¼€æ€»çº¿æ—¶ æ€»çº¿ä»£è¡¨æ˜¾æ€§0 å½“æ‰€æœ‰ä¸»æœºéƒ½é‡Šæ”¾æ€»çº¿æ—¶ æ€»çº¿æ‰ä»£è¡¨éšæ€§1</p>
<p>å›è¯»æœºåˆ¶: æ¯ä¸ªä¸»æœºåœ¨å‘é€æ•°æ®åéƒ½ä¼šè¯»å–æ€»çº¿çš„çŠ¶æ€</p>
<p>æ ¹æ®ä¸Šè¿°ä¸¤ä¸ªæœºåˆ¶å¾—åˆ°ä»²è£çš„ç‰¹æ€§</p>
<p>å½“ä¸»æœºå‘å‡ºéšæ€§1ä½†æ˜¯è¯»å›çš„ç¡®å®æ˜¾æ€§0æ—¶, è¯´æ˜å½“å‰æœ‰ä¸»æœºæ­£åœ¨ä½¿ç”¨è¯¥ä¸»çº¿å‘é€æ•°æ® ä½†æ˜¯å‘é€0çš„è¿™ä¸ªä¸»æœºå´ä¸çŸ¥é“æœ‰å¦ä¸€ä¸ªä¸»æœºæ­£åœ¨ä½¿ç”¨è¿™æ¡ä¸»çº¿ </p>
<p>è¿™æ—¶å‘é€1çš„ä¸»æœºä»²è£å¤±è´¥, å›åˆ°è¯»å–çŠ¶æ€</p>
<p>è¿™ä¹Ÿå†³å®šäº†æ€»æ˜¯å‘é€IDå·å°çš„å¸§çš„æ•°æ®ä»²è£ä¼šæˆåŠŸ</p>
<p>Q: ä½å¡«å……æ˜¯å¦ä¼šå½±å“åˆ°ä»²è£?</p>
<p>A: ç»“è®ºæ˜¯ä¸ä¼š, å‡è®¾ä½å¡«å……ä¼šå½±å“åˆ°ä»²è£ é‚£ä¹ˆä½å¡«å……ä¹‹å‰çš„ä½å‡ä¸ºä¸€æ ·çš„, è¿™ç§æƒ…å†µæ˜¾ç„¶ä¸ä¼šå½±å“,å› ä¸ºå¡«å……çš„é‚£ä½ä¹Ÿæ˜¯ç›¸åŒçš„ å¦‚æœä½å¡«å……ä¹‹å‰çš„ä½éƒ½ä¸ä¸€æ ·, é‚£æ›´ä¸å¯èƒ½äº† å¦‚æœåªæœ‰ä¸€ä¸ªä¸»æœºäº§ç”Ÿä½å¡«å…… é‚£å¾ˆæ˜æ˜¾å‰é¢5ä½ç»ä¸ç›¸åŒ, è¿™ç‚¹ä¹Ÿæ¯‹åº¸ç½®ç–‘</p>
<p>é‚£ä¹ˆä¸¤ä¸ªä¸»æœºå‘é€åŒä¸€ä¸ªIDå·çš„æ•°æ®å¸§å’Œé¥æ§å¸§çš„æƒ…å†µå‘¢</p>
<p>æ•°æ®å¸§çš„RTRä½ä¸º0, é¥æ§å¸§çš„RTRä½ä¸º1</p>
<p>å‘é€é¥æ§å¸§çš„ä¸»æœºä¼šä»²è£å¤±è´¥</p>
<p>å›åˆ°å®é™…æ„ä¹‰æ¥è®², å‘é€é¥æ§å¸§çš„ä¸»æœºè·å¾—çš„æ•°æ®æ°¸è¿œæ˜¯æœ€æ–°çš„, ä¸ä¼šå¯¼è‡´æ•°æ®ä¸åŒæ­¥çš„é”™è¯¯æƒ…å†µ, è¿™ç‚¹æ˜¯ç¬¦åˆå®é™…é¡¹ç›®è¦æ±‚çš„</p>
<p>é‚£ä¹ˆæ‹“å±•æ ¼å¼çš„æƒ…å†µå‘¢</p>
<p>åŒæ ·åˆ†æ ‡å‡†æ•°æ®å¸§å’Œæ ‡å‡†é¥æ§å¸§æ¥è®¨è®º, æ‹“å±•æ ¼å¼ä¸­æ•°æ®å¸§å’Œé¥æ§å¸§å’Œä¸Šé¢è®¨è®ºæƒ…å†µç›¸åŒ</p>
<p>å…ˆè¯´æ ‡å‡†æ•°æ®å¸§</p>
<p>æ‹“å±•æ ¼å¼çš„SRRä½(å¯¹åº”çš„å°±æ˜¯æ ‡å‡†æ ¼å¼çš„RTRä½)ä¸ºéšæ€§1, æ‰€ä»¥é¢å¯¹æ ‡å‡†æ•°æ®å¸§, æ‹“å±•æ ¼å¼æ˜¯ä»²è£å¤±åˆ©çš„</p>
<p>é‚£ä¹ˆæ ‡å‡†é¥æ§å¸§å‘¢</p>
<p>é¥æ§å¸§çš„RTRä½ä¸º1, åŒæ—¶ä»²è£æ®µä¹Ÿåªæ˜¯ID + RTR è¿™ä¸€æ®µ</p>
<p>é‚£ä¹ˆé¥æ§å¸§å°±æœ‰äº†å¿…èƒœçš„ç†ç”±,é‚£ä¹ˆæˆ‘ä»¬æ¥ç€çœ‹</p>
<p>RTRä½ç´§è·Ÿç€çš„å°±æ˜¯IDEä½, æ‹“å±•æ ¼å¼çš„è¿™ä¸€ä½è§„å®šç½®ä¸ºéšæ€§1, æ‰€ä»¥å¿…å®šä¼šä»²è£å¤±è´¥</p>
<p>è¿™é‡Œå’Œå‰é¢å¸§æ ¼å¼ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå®šä¹‰å½¢æˆé€»è¾‘é—­ç¯</p>
<h2 id="é”™è¯¯å¤„ç†"><a href="#é”™è¯¯å¤„ç†" class="headerlink" title="é”™è¯¯å¤„ç†"></a>é”™è¯¯å¤„ç†</h2><p>5ç§é”™è¯¯: ä½é”™è¯¯(å›è¯»), å¡«å……é”™è¯¯, CRCé”™è¯¯, æ ¼å¼é”™è¯¯(å„ç§ç•Œå®šç¬¦é”™è¯¯), ACKé”™è¯¯</p>
<p>é”™è¯¯çŠ¶æ€æœºåˆ¶ä¸TEC(Transmit Error Counter), REC</p>
<p>TECå’ŒRECå¹¶ä¸æ€»æ˜¯æ¯æ¬¡-1, å¾ˆå¤§å¯èƒ½æ˜¯ä¸€æ¬¡-8, ä½†éœ€è¦8æ¬¡æ­£ç¡®ä¼ è¾“æ‰èƒ½è¡¥æ•‘å›æ¥</p>
<p><img src="/../images/CAN%E6%80%BB%E7%BA%BF/0.png" alt="0"></p>
<p>Q: ä¸ºä»€ä¹ˆç»“æŸçš„EOFè¦ç»™7ä¸ªéšæ€§1</p>
<p>A: ä¸€æ˜¯7ä¸ªéšæ€§1 + ACKç•Œå®šç¬¦(ä¸€ä½) + 3ä½å¸§é—´éš” åˆšå¥½11ä½éšæ€§1, è¿™ä¹‹åæ»¡è¶³è¿›å…¥ç©ºé—²çŠ¶æ€çš„è¦æ±‚</p>
<p>äºŒæ˜¯ç•™ç»™é”™è¯¯å¤„ç†ç½®é”™è¯¯æ ‡å¿—ä¸€æ®µæ—¶é—´, é¿å…æ¥æ”¶æ–¹è¿˜æœªæ„è¯†åˆ°å‘é€çš„æ•°æ®é”™äº†å°±å·²ç»è¿›å…¥ä¸‹ä¸€å¸§äº†</p>
<p>Q: åœ¨å“ªä¸ªåŒºæ®µé‡Œä¼šäº§ç”Ÿä½å¡«å……ç°è±¡</p>
<p>SOFåˆ°CRCæ ¡éªŒä¹‹é—´çš„æ•°æ®</p>
<p>Q: å»¶è¿Ÿä¼ é€çš„ä½œç”¨</p>
<p>å…¶ä¸­ä¸€ä¸ªä½œç”¨æ˜¯ä½¿å…¶å¤„äºä»²è£å¤±åˆ©, é¿å…æ˜“å‡ºé”™çš„è®¾å¤‡ä¼˜å…ˆå»å‘é€æ•°æ®å ç”¨æ€»çº¿èµ„æº</p>
<h2 id="ä½å±è”½æœºåˆ¶"><a href="#ä½å±è”½æœºåˆ¶" class="headerlink" title="ä½å±è”½æœºåˆ¶"></a>ä½å±è”½æœºåˆ¶</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//32ä½å±è”½#2</span></span><br><span class="line"><span class="comment">//è¿™é‡Œå¦‚æœä¸ | 0x04åˆ™ä¼šæ··å…¥æ ‡å‡†æ ¼å¼0x1xxçš„æ•°æ® å…·ä½“åˆ†æè§æ³¨é‡Šçš„äºŒè¿›åˆ¶æ•°</span></span><br><span class="line">CAN_FilterInitStructure.CAN_FilterScale = CAN_FilterScale_32bit;</span><br><span class="line">CAN_FilterInitStructure.CAN_FilterMode = CAN_FilterMode_IdMask;</span><br><span class="line"><span class="type">uint32_t</span> ID = (<span class="number">0x04000000u</span> &lt;&lt; <span class="number">3</span>);<span class="comment">//è¿™é‡Œå’Œ0x100 &lt;&lt; 21æ•ˆæœç›¸åŒ		//0b 001 0000 0000 0000 0000 0000 0000 00 000</span></span><br><span class="line">CAN_FilterInitStructure.CAN_FilterIdHigh = ID &gt;&gt; <span class="number">16</span>;			<span class="comment">//0x10100000 0b 1 0000 0001 0000 0000 0000 0000 0000 000</span></span><br><span class="line">															<span class="comment">//0b 0 0100 0000 0000 0000 0000 0000 0000 000 0x04000000</span></span><br><span class="line">CAN_FilterInitStructure.CAN_FilterIdLow = ID;	<span class="comment">//uint32å¼ºè½¬ä¸ºuint16æ—¶ä¼šèˆå¼ƒæ‰é«˜4ä½</span></span><br><span class="line"><span class="type">uint32_t</span> Mask = (<span class="number">0x1C000000u</span> &lt;&lt; <span class="number">3</span>);<span class="comment">//è¿™é‡Œå’Œ0x700 &lt;&lt; 21æ•ˆæœç›¸åŒ</span></span><br><span class="line">CAN_FilterInitStructure.CAN_FilterMaskIdHigh = Mask &gt;&gt; <span class="number">16</span>;		<span class="comment">//0b 111 0000 0000 0000 0000 0000 0000 00 000</span></span><br><span class="line">CAN_FilterInitStructure.CAN_FilterMaskIdLow = Mask;				<span class="comment">//0b 1 1100 0000 0000 0000 0000 0000 0000 000</span></span><br><span class="line"></span><br><span class="line">CAN_FilterInitStructure.CAN_FilterFIFOAssignment = CAN_Filter_FIFO0;</span><br><span class="line">CAN_FilterInitStructure.CAN_FilterActivation = ENABLE;</span><br><span class="line">CAN_FilterInit(&amp;CAN_FilterInitStructure);</span><br></pre></td></tr></table></figure>

<h2 id="ä¸­æ–­"><a href="#ä¸­æ–­" class="headerlink" title="ä¸­æ–­"></a>ä¸­æ–­</h2><table>
<thead>
<tr>
<th>ä¸­æ–­å®</th>
<th>å«ä¹‰</th>
<th>è§¦å‘æ—¶æœº</th>
</tr>
</thead>
<tbody><tr>
<td>CAN_IT_TME</td>
<td>å‘é€é‚®ç®±ç©º</td>
<td>å¯ä»¥å‘é€ä¸‹ä¸€å¸§</td>
</tr>
<tr>
<td>CAN_IT_FMP0</td>
<td>FIFO0 æœ‰æ¶ˆæ¯</td>
<td>æ¥æ”¶åˆ°æ•°æ®</td>
</tr>
<tr>
<td>CAN_IT_FF0</td>
<td>FIFO0 æ»¡</td>
<td>3 æ¡æ¶ˆæ¯æ»¡äº†</td>
</tr>
<tr>
<td>CAN_IT_FOV0</td>
<td>FIFO0 æº¢å‡º</td>
<td>æ•°æ®è¦†ç›–</td>
</tr>
<tr>
<td>CAN_IT_FMP1</td>
<td>FIFO1 æœ‰æ¶ˆæ¯</td>
<td>æ¥æ”¶åˆ°æ•°æ®</td>
</tr>
<tr>
<td>CAN_IT_FF1</td>
<td>FIFO1 æ»¡</td>
<td></td>
</tr>
<tr>
<td>CAN_IT_FOV1</td>
<td>FIFO1 æº¢å‡º</td>
<td></td>
</tr>
<tr>
<td>CAN_IT_EWG</td>
<td>é”™è¯¯è­¦å‘Š</td>
<td>é”™è¯¯è®¡æ•° &gt; 96</td>
</tr>
<tr>
<td>CAN_IT_EPV</td>
<td>é”™è¯¯è¢«åŠ¨</td>
<td>é”™è¯¯è®¡æ•° &gt;&#x3D; 128</td>
</tr>
<tr>
<td>CAN_IT_LEC</td>
<td>æœ€åé”™è¯¯ç å˜åŒ–</td>
<td>å‡ºç°æ–°çš„é”™è¯¯</td>
</tr>
<tr>
<td>CAN_IT_ERR</td>
<td>ä»»æ„é”™è¯¯äº‹ä»¶</td>
<td>CRC&#x2F;ACK&#x2F;stuff ç­‰é”™è¯¯</td>
</tr>
<tr>
<td>CAN_IT_WKU</td>
<td>å”¤é†’</td>
<td>ä» sleepâ†’æ­£å¸¸æ¨¡å¼</td>
</tr>
<tr>
<td>CAN_IT_SLK</td>
<td>ç¡çœ å®Œæˆ</td>
<td></td>
</tr>
</tbody></table>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/07/15/l3hcf2025-wp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="Sn0r1ax">
      <meta itemprop="description" content="ğŸ˜˜ğŸ˜˜ğŸ˜˜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sn0r1ax">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/07/15/l3hcf2025-wp/" class="post-title-link" itemprop="url">l3hcf2025 wp</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-07-15 17:16:03" itemprop="dateCreated datePublished" datetime="2025-07-15T17:16:03+08:00">2025-07-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-09-26 21:33:52" itemprop="dateModified" datetime="2025-09-26T21:33:52+08:00">2025-09-26</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          Here's something encrypted, password is required to continue reading.
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2025/07/15/l3hcf2025-wp/#more" rel="contents">
                é˜…è¯»å…¨æ–‡ &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/06/04/%E4%BB%8ED-Link_DIR815%E8%B7%AF%E7%94%B1%E5%99%A8%E7%BB%8F%E5%85%B8%E6%BC%8F%E6%B4%9E%E5%BC%80%E5%90%AFIOT%E4%B9%8B%E6%97%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="Sn0r1ax">
      <meta itemprop="description" content="ğŸ˜˜ğŸ˜˜ğŸ˜˜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sn0r1ax">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/06/04/%E4%BB%8ED-Link_DIR815%E8%B7%AF%E7%94%B1%E5%99%A8%E7%BB%8F%E5%85%B8%E6%BC%8F%E6%B4%9E%E5%BC%80%E5%90%AFIOT%E4%B9%8B%E6%97%85/" class="post-title-link" itemprop="url">ä»D-Link_DIR815è·¯ç”±å™¨ç»å…¸æ¼æ´å¼€å¯IOTä¹‹æ—…</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-06-04 20:36:59" itemprop="dateCreated datePublished" datetime="2025-06-04T20:36:59+08:00">2025-06-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-06-08 21:04:49" itemprop="dateModified" datetime="2025-06-08T21:04:49+08:00">2025-06-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><p>ä¸ªäººæ„Ÿè§‰éº»çƒ¦çš„ç‚¹åœ¨äºç¯å¢ƒçš„æ­å»º(åˆå›åˆ°æœ€åˆä¸€ç“¶å†œå¤«å±±æ³‰æé‚£é…ä¸€å¤©ç¯å¢ƒçš„æ—¥å­,ä¸€ä¸ªç‚¹æ²¡æ³¨æ„å°±å‡ºé—®é¢˜,ç”šè‡³æ¡Œä¸Šçš„å†œå¤«å±±æ³‰éƒ½æ¢æˆäº†æ€¡å®),æœ¬æ–‡ç€é‡è®°å½•ä¸‹è‡ªå·±è¸©å¾—å‘,å¯¹äºæ¼æ´çš„è¯¦ç»†åˆ†æå¯ä»¥çœ‹çœ‹å‚è€ƒæ–‡ç« .ç„¶åå…³äºIOTé€šä¿¡è¿˜æ¶‰åŠåˆ°httpåè®®å’Œcgi,æˆ‘ä¹Ÿä»¥æˆ‘çš„ç†è§£ç®€å•ä»‹ç»ä¸‹</p>
<p>è¿˜ä»‹ç»äº†çº¯ropé“¾å’Œshellcodeä¸¤ç§æ¼æ´åˆ©ç”¨æ–¹æ³•,æåˆ°shellcodeæ¥getshellæ—¶å‡ºç°çš„ä¸€äº›é—®é¢˜</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2025/06/04/%E4%BB%8ED-Link_DIR815%E8%B7%AF%E7%94%B1%E5%99%A8%E7%BB%8F%E5%85%B8%E6%BC%8F%E6%B4%9E%E5%BC%80%E5%90%AFIOT%E4%B9%8B%E6%97%85/#more" rel="contents">
                é˜…è¯»å…¨æ–‡ &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="ä¸‹ä¸€é¡µ"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Sn0r1ax"
      src="/uploads/avatar.png">
  <p class="site-author-name" itemprop="name">Sn0r1ax</p>
  <div class="site-description" itemprop="description">ğŸ˜˜ğŸ˜˜ğŸ˜˜</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">35</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/PMexeggcute" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;PMexeggcute" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sn0r1ax</span>
</div>

<!-- <br /> --> <!-- ç½‘ç«™è¿è¡Œæ—¶é—´çš„è®¾ç½® --> <span id="timeDate">è½½å…¥å¤©æ•°...</span> <!-- <span id="times">è½½å…¥æ—¶åˆ†ç§’...</span> --> <script>   var now = new Date();   function createtime() {     var grt= new Date("11/17/2022 8:00:00");//æ­¤å¤„ä¿®æ”¹ä½ çš„å»ºç«™æ—¶é—´æˆ–è€…ç½‘ç«™ä¸Šçº¿æ—¶é—´     now.setTime(now.getTime()+250);     days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);     hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);     if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);     mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}     seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);     snum = Math.round(seconds);      if(String(snum).length ==1 ){snum = "0" + snum;}     // var times = document.getElementById("times").innerHTML = hnum + " å°æ—¶ " + mnum + " åˆ† " + snum + " ç§’";     document.getElementById("timeDate").innerHTML = "æœ¬ç«™å·²å®‰å…¨è¿è¡Œ "+dnum+" å¤© "+hnum + " å°æ—¶ " + mnum + " åˆ† " + snum + " ç§’";   } setInterval("createtime()",250); </script>

<!-- <br /> -->
<!-- ç½‘ç«™è¿è¡Œæ—¶é—´çš„è®¾ç½® -->
<span id="timeDate">...</span>
<!-- <span id="times">è½½å…¥æ—¶åˆ†ç§’...</span> -->
<script>
 Â   var now = new Date();
 Â   function createtime() {
 Â  Â  Â   var grt= new Date("3/10/2025 8:00:00");//æ­¤å¤„ä¿®æ”¹ä½ çš„å»ºç«™æ—¶é—´æˆ–è€…ç½‘ç«™ä¸Šçº¿æ—¶é—´
 Â  Â  Â   now.setTime(now.getTime()+250);
 Â  Â  Â   days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
 Â  Â  Â   hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
 Â  Â  Â   if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
 Â  Â  Â   mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
 Â  Â  Â   seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
 Â  Â  Â   snum = Math.round(seconds); 
 Â  Â  Â   if(String(snum).length ==1 ){snum = "0" + snum;}
 Â  Â  Â   // var times = document.getElementById("times").innerHTML = hnum + " å°æ—¶ " + mnum + " åˆ† " + snum + " ç§’";
 Â  Â  Â   document.getElementById("timeDate").innerHTML = "æœ¬ç«™å·²å®‰å…¨è¿è¡Œ "+dnum+" å¤© "+hnum + " å°æ—¶ " + mnum + " åˆ† " + snum + " ç§’";
 Â   }
setInterval("createtime()",250);
</script>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  


</body>
</html>
